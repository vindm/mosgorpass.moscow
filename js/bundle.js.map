{"version":3,"sources":["js/node_modules/browser-pack/_prelude.js","js/src/js/entry.js","js/src/js/lib/debounce.js","js/src/js/lib/pager.js","js/src/js/lib/scroll.js"],"names":[],"mappings":"AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC9CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACxBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACxeA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"bundle.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","require('./lib/pager');\n\n$(function() {\n    var $pager = $('.pager'),\n        $video = $('.pager__page').eq(0),\n        $screens = $('.screens'),\n        $screensImages = $('.screens__images'),\n        video = $video.data('vide').getVideoObject(),\n        pager;\n\n    $pager.pager();\n    pager = $pager.data('pager');\n\n    $('.screens__nav_dir_next').click(function() {\n        pager.step(1);\n    });\n\n    $('.screens__nav_dir_prev').click(function() {\n        pager.step(-1);\n    });\n\n    $pager\n        .on('change_start', function() {\n            video.pause();\n        })\n        .on('change_done', function(e, data) {\n            if (data.current.$elem.is($video)) {\n                video.play();\n            }\n        })\n        .on('change_step', function(e, data) {\n            pager.disable();\n\n            $screens\n                .removeClass('screens_step_' + data.prev)\n                .addClass('screens_step_' + data.current);\n\n            $screensImages\n                .css('transform', 'translate3d(0, ' + data.current * -10 + '%, 0)');\n\n            setTimeout(function() {\n                pager.enable();\n            }, data.isFirst || data.isLast ? 1100 : 900);\n        });\n\n});\n","module.exports = function(fn, timeout, invokeAsap, ctx) {\n    if(arguments.length == 3 && typeof invokeAsap != 'boolean') {\n        ctx = invokeAsap;\n        invokeAsap = false;\n    }\n\n    var timer;\n\n    return function() {\n\n        var args = arguments;\n        ctx = ctx || this;\n\n        invokeAsap && !timer && fn.apply(ctx, args);\n\n        clearTimeout(timer);\n\n        timer = setTimeout(function() {\n            invokeAsap || fn.apply(ctx, args);\n            timer = null;\n        }, timeout);\n\n    };\n};\n","var debounce = require('./debounce'),\n    scroll = require('./scroll');\n\n(function(doc, win, $, undefined) {\n    var $win = $(win);\n\n    var Pager = function(elem) {\n        var $elem = $(elem),\n            $movable = $elem.find('.pager__movable');\n\n        if ($movable.length === 0) {\n            $movable = $elem;\n        }\n\n        this._$elem = $elem;\n        this._items = [];\n        this._itemsCount = 0;\n        this._currentItem = null;\n\n        this.addItems($movable.children('article'));\n\n        this._onResize = debounce(this._onResize, 100, true, this);\n        this._onScroll = debounce(this._onScroll, 500, true, this);\n        this._onTouchEnd = this._onTouchEnd.bind(this);\n        this._onTouchStart = this._onTouchStart.bind(this);\n        this._onWheelScroll = this._onWheelScroll.bind(this);\n\n        this._bindEvents(true);\n        this._onResize();\n\n        $win.on('resize', this._onResize);\n\n        $elem.data('pager', this);\n    };\n\n    var pager = Pager.prototype;\n\n    pager.step = function(delta) {\n        var currentItem = this._currentItem,\n            steps = currentItem.steps,\n            isDown = delta > 0,\n            nextStep,\n            step;\n\n        if (steps) {\n            step = currentItem.step;\n            nextStep = step + (isDown ? 1 : -1);\n        }\n\n        if (nextStep >= 0 && nextStep <= steps) {\n            currentItem.step = nextStep;\n\n            this._$elem.trigger('change_step', {\n                item: currentItem,\n                prev: step,\n                current: nextStep,\n                isLast: nextStep === steps,\n                isFirst: nextStep === 0\n            });\n\n            return this;\n        }\n    };\n\n    /**\n     * @param {Number} delta\n     * @param {Object} [options]\n     * @returns {Pager}\n     */\n    pager.move = function(delta, options) {\n        var opts = options || {},\n            item,\n            isDown,\n            position,\n            currentItem,\n            currentPosition;\n\n        if (this.isDisabled || this.scrolling) {\n            this._lastScrollDelta = delta;\n\n            return this;\n        }\n\n        if (delta === 0) {\n            return this;\n        }\n\n        isDown = delta > 0;\n        currentItem = this._currentItem;\n        currentPosition = this._currentPosition;\n\n        if (\n            opts.checkSteps && currentPosition === currentItem.start &&\n            ( ! opts.checkScroll || this._isRealScroll(delta))\n        ) {\n            if (this.step(delta)) {\n                return this;\n            }\n        }\n\n        position = currentPosition + delta;\n\n        if (delta > 0 && currentPosition < currentItem.winHeightDiff) {\n            position = Math.min(position, currentItem.winHeightDiff);\n        }\n        if (delta < 0 && currentPosition > currentItem.start) {\n            position = Math.max(position, currentItem.start);\n        }\n\n        item = this._getItemByPosition(position, isDown ? 'down' : 'up');\n\n        if (item !== currentItem) {\n            if ( ! opts.checkScroll || this._isRealScroll(delta)) {\n                this._currentPosition = item.start;\n\n                this.goTo(item.index, true);\n            }\n        } else {\n            this._lastScrollDelta = delta;\n            this._currentPosition = Math.max(item.start, Math.min(position, item.winHeightDiff));\n            this._currentItem = item;\n\n            this.moveTo({\n                to: this._currentPosition,\n                duration: 0\n            });\n        }\n\n        return this;\n    };\n\n    /**\n     * @returns {Pager}\n     */\n    pager.prev = function() {\n        this.goTo(this._currentItem ? this._currentItem.index - 1 : 0);\n\n        return this;\n    };\n\n    /**\n     * @returns {Pager}\n     */\n    pager.next = function() {\n        this.goTo(this._currentItem ? this._currentItem.index + 1 : 0);\n\n        return this;\n    };\n\n    /**\n     * @returns {Pager}\n     */\n    pager.goTo = function(itemIndex, isForce) {\n        var currentItem = this.getItem(itemIndex);\n\n        if (currentItem) {\n            this.setCurrentItem(currentItem, isForce);\n        }\n\n        return this;\n    };\n\n    /**\n     * @param {jQuery} $items\n     * @returns {Pager}\n     */\n    pager.addItems = function($items) {\n        var _this = this,\n            $slide;\n\n        $.each($items, function(ind, slide) {\n            $slide = $(slide);\n\n            _this._itemsCount = _this._items.push({\n                index: ind,\n                step: parseInt($slide.data('step'), 10) || 0,\n                steps: parseInt($slide.data('steps'), 10) || 0,\n                $elem: $slide\n            });\n        });\n\n        return _this;\n    };\n\n    /**\n     * @param {Number|String} [itemIndex]\n     * @returns {?Object}\n     */\n    pager.getItem = function(itemIndex) {\n        var index = false;\n\n        if (typeof itemIndex === 'string') {\n            this._items.some(function(slide, ind) {\n                if (slide.id === itemIndex) {\n                    index = ind;\n\n                    return false;\n                }\n            });\n        }\n\n        if ($.isNumeric(itemIndex)) {\n            index = itemIndex > -1 && itemIndex < this._itemsCount && itemIndex;\n        } else if ( ! itemIndex) {\n            index = this._currentItem && this._currentItem.index;\n        }\n\n        return $.isNumeric(index) ?\n            this._items[index] :\n            null;\n    };\n\n    /**\n     * @param {String} [direction]\n     * @returns {Pager}\n     */\n    pager.updatePosition = function(direction) {\n        var item = this._getItemByPosition(this._currentPosition, direction);\n\n        if (item !== this._currentItem) {\n            this.goTo(item.index, true);\n        }\n\n        return this;\n    };\n\n    /**\n     * @param {Object} currentItem\n     * @param {Boolean} [isForce]\n     * @returns {Pager}\n     */\n    pager.setCurrentItem = function(currentItem, isForce) {\n        var _this = this,\n            prevItem = _this._currentItem,\n            isCurrent = currentItem === prevItem;\n\n        if ( ! isForce && isCurrent) {\n            return this;\n        }\n\n        if ( ! isCurrent) {\n            // prevItem && prevItem.$elem.removeClass('current');\n\n            _this._$elem.trigger('change_start', {\n                next: currentItem,\n                current: prevItem\n            });\n        }\n\n        _this\n            .moveTo({ to: currentItem.start })\n            .then(function() {\n                if ( ! isCurrent) {\n                    // currentItem.$elem.addClass('current');\n\n                    _this._currentItem = currentItem;\n                    _this._$elem\n                        .trigger('change_done', {\n                            prev: prevItem,\n                            current: currentItem\n                        });\n                }\n            });\n\n        return this;\n    };\n\n    /**\n     * @param {Object} opts\n     * @return {?jQuery.Deferred}\n     */\n    pager.moveTo = function(opts) {\n        var _this = this;\n\n        if (_this.scrolling) {\n            _this.scrolling.reject();\n        }\n\n        _this.scrolling = scroll(_this._$elem, opts);\n\n        _this.scrolling\n            .always(function() {\n                setTimeout(function() {\n                    _this.scrolling = null;\n                }, 0);\n            });\n\n        return _this.scrolling;\n    };\n\n    pager.disable = function() {\n        this.isDisabled = true;\n    };\n\n    pager.enable = function() {\n        this.isDisabled = false;\n    };\n\n    /**\n     * @private\n     * @param {Number} [position] Позиция\n     * @param {String} [direction] Направление\n     * @returns {?Object} Айтем, соответствующий позиции\n     */\n    pager._getItemByPosition = function(position, direction) {\n        var start = position || this._currentPosition,\n            end = start + this.winSize.height,\n            items = this._items,\n            itemsLen = this._itemsCount,\n            checkingIndex = 0,\n            offset,\n            item;\n\n        while ((item = items[checkingIndex++])) {\n            offset = start - item.start;\n\n            if ( ! direction) {\n                if (item.height / 2 >= offset) {\n                    break;\n                }\n            } else {\n                if (direction === 'down' && item.start <= end && item.end >= end) {\n                    break;\n                }\n\n                if (direction === 'up' && item.end > start) {\n                    break;\n                }\n            }\n        }\n\n        if ( ! item) {\n            item = direction === 'down' ? items[itemsLen - 1] : items[0];\n        }\n\n        return item;\n    };\n\n    /**\n     * @private\n     * @param {Boolean} isOn\n     */\n    pager._bindEvents = function(isOn) {\n        this._$elem[isOn ? 'on' : 'off'](true || ('ontouchstart' in doc.documentElement) ?\n            {\n                touchend: this._onTouchEnd,\n                touchstart: this._onTouchStart,\n                scroll: function(e) { e.preventDefault(); e.stopPropagation(); return false; }\n            } :\n            {\n                wheel: this._onWheelScroll,\n                scroll: this._onScroll\n            });\n\n        $('.pager__nav_dir_next').click(this.next.bind(this));\n        $('.pager__nav_dir_prev').click(this.prev.bind(this));\n    };\n\n    /**\n     * @private\n     * @param {Number} newDelta\n     * @returns {Bboolean}\n     */\n    pager._isRealScroll = function(newDelta) {\n        var oldDelta = this._lastScrollDelta,\n            isRealScroll = false;\n\n        if (oldDelta !== null) {\n            // different direction\n            if (oldDelta < 0 && newDelta > 0) {\n                isRealScroll = true;\n            }\n            if (oldDelta > 0 && newDelta < 0) {\n                isRealScroll = true;\n            }\n            // same direction\n            if (oldDelta > 0 && newDelta > 0) {\n                isRealScroll = oldDelta < newDelta;\n            }\n            if (oldDelta < 0 && newDelta < 0) {\n                isRealScroll = oldDelta > newDelta;\n            }\n        } else {\n            isRealScroll = true;\n        }\n\n        this._lastScrollDelta = newDelta;\n\n        return isRealScroll;\n    };\n\n    /**\n     * @private\n     * @param {jQuery.Event} event\n     */\n    pager._onWheelScroll = function(event) {\n        var e = event.originalEvent || window.event;\n\n        if (Math.abs(e.deltaY) < Math.abs(e.deltaX)) {\n            return;\n        }\n\n        this.move(e.deltaY, {\n            checkScroll: true,\n            checkSteps: true\n        });\n\n        event.preventDefault();\n        event.stopPropagation();\n\n        return false;\n    };\n\n    /**\n     * @private\n     * @param {jQuery.Event} event\n     */\n    pager._onTouchStart = function(event) {\n        var touches = event.originalEvent.targetTouches;\n\n        // игнорим если на экране слишком много пальцев\n        if (touches && touches.length > 1) {\n            return;\n        }\n\n        this._touchStart = touches ? touches[0] : event.originalEvent;\n    };\n\n    /**\n     * @private\n     * @param {jQuery.Event} event\n     */\n    pager._onTouchEnd = function(event) {\n        var touches = event.originalEvent.changedTouches,\n            currentTouch = touches ? touches[0] : event.originalEvent;\n\n        this.move(this._touchStart.pageY - currentTouch.pageY);\n\n        event.preventDefault();\n        event.stopPropagation();\n\n        return false;\n    };\n\n    /**\n     * @private\n     */\n    pager._onScroll = function(event) {\n        console.error('scroll', event, this._$elem.scrollTop(), this._currentPosition);\n\n        this.move(this._$elem.scrollTop() - this._currentPosition);\n\n        event.preventDefault();\n        event.stopPropagation();\n\n        return false;\n    };\n\n    /**\n     * @private\n     */\n    pager._onResize = function() {\n        var winHeight = $win.height(),\n            lastEnd = 0;\n\n        this._items.forEach(function(slide) {\n            slide.height = slide.$elem.outerHeight();\n            slide.start = lastEnd;\n            slide.end = (lastEnd += slide.height);\n            slide.winHeightDiff = slide.end - winHeight;\n        });\n\n        this.winSize || (this.winSize = {});\n        this.winSize.height = winHeight;\n\n        this._currentPosition = this._$elem.scrollTop();\n\n        this.updatePosition();\n    };\n\n    $.fn.pager = function(options) {\n        this.each(function(ind, elem) {\n            /* jshint -W031 */\n            new Pager(elem, options);\n        });\n    };\n\n})(document, window, jQuery);\n","module.exports = function($elem, options) {\n    var opts = options || {},\n        to = parseInt(options.to, 10),\n        duration = parseInt(opts.duration, 10),\n        deff = $.Deferred(),\n        easing;\n\n    if (isNaN(duration)) {\n        duration = Math.sqrt(Math.abs($elem.scrollTop() - to)) * 40;\n    }\n\n    if (duration > 0) {\n        easing = opts.easing;\n\n        if (typeof easing !== 'string') {\n            easing = 'easeOutCubic';\n        }\n        if (typeof $.easing[easing] !== 'function') {\n            easing = 'linear';\n        }\n    }\n\n    $elem\n        .stop()\n        .animate(\n            { scrollTop: to },\n            {\n                duration: duration,\n                easing: easing,\n                queue: false,\n                done: function() {\n                    deff.resolve();\n                }\n            });\n\n    return deff;\n};\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvanMvZW50cnkuanMiLCJzcmMvanMvbGliL2RlYm91bmNlLmpzIiwic3JjL2pzL2xpYi9wYWdlci5qcyIsInNyYy9qcy9saWIvc2Nyb2xsLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM5Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN4ZUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJyZXF1aXJlKCcuL2xpYi9wYWdlcicpO1xuXG4kKGZ1bmN0aW9uKCkge1xuICAgIHZhciAkcGFnZXIgPSAkKCcucGFnZXInKSxcbiAgICAgICAgJHZpZGVvID0gJCgnLnBhZ2VyX19wYWdlJykuZXEoMCksXG4gICAgICAgICRzY3JlZW5zID0gJCgnLnNjcmVlbnMnKSxcbiAgICAgICAgJHNjcmVlbnNJbWFnZXMgPSAkKCcuc2NyZWVuc19faW1hZ2VzJyksXG4gICAgICAgIHZpZGVvID0gJHZpZGVvLmRhdGEoJ3ZpZGUnKS5nZXRWaWRlb09iamVjdCgpLFxuICAgICAgICBwYWdlcjtcblxuICAgICRwYWdlci5wYWdlcigpO1xuICAgIHBhZ2VyID0gJHBhZ2VyLmRhdGEoJ3BhZ2VyJyk7XG5cbiAgICAkKCcuc2NyZWVuc19fbmF2X2Rpcl9uZXh0JykuY2xpY2soZnVuY3Rpb24oKSB7XG4gICAgICAgIHBhZ2VyLnN0ZXAoMSk7XG4gICAgfSk7XG5cbiAgICAkKCcuc2NyZWVuc19fbmF2X2Rpcl9wcmV2JykuY2xpY2soZnVuY3Rpb24oKSB7XG4gICAgICAgIHBhZ2VyLnN0ZXAoLTEpO1xuICAgIH0pO1xuXG4gICAgJHBhZ2VyXG4gICAgICAgIC5vbignY2hhbmdlX3N0YXJ0JywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2aWRlby5wYXVzZSgpO1xuICAgICAgICB9KVxuICAgICAgICAub24oJ2NoYW5nZV9kb25lJywgZnVuY3Rpb24oZSwgZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEuY3VycmVudC4kZWxlbS5pcygkdmlkZW8pKSB7XG4gICAgICAgICAgICAgICAgdmlkZW8ucGxheSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgICAub24oJ2NoYW5nZV9zdGVwJywgZnVuY3Rpb24oZSwgZGF0YSkge1xuICAgICAgICAgICAgcGFnZXIuZGlzYWJsZSgpO1xuXG4gICAgICAgICAgICAkc2NyZWVuc1xuICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcygnc2NyZWVuc19zdGVwXycgKyBkYXRhLnByZXYpXG4gICAgICAgICAgICAgICAgLmFkZENsYXNzKCdzY3JlZW5zX3N0ZXBfJyArIGRhdGEuY3VycmVudCk7XG5cbiAgICAgICAgICAgICRzY3JlZW5zSW1hZ2VzXG4gICAgICAgICAgICAgICAgLmNzcygndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZTNkKDAsICcgKyBkYXRhLmN1cnJlbnQgKiAtMTAgKyAnJSwgMCknKTtcblxuICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBwYWdlci5lbmFibGUoKTtcbiAgICAgICAgICAgIH0sIGRhdGEuaXNGaXJzdCB8fCBkYXRhLmlzTGFzdCA/IDExMDAgOiA5MDApO1xuICAgICAgICB9KTtcblxufSk7XG4iLCJtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGZuLCB0aW1lb3V0LCBpbnZva2VBc2FwLCBjdHgpIHtcbiAgICBpZihhcmd1bWVudHMubGVuZ3RoID09IDMgJiYgdHlwZW9mIGludm9rZUFzYXAgIT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgIGN0eCA9IGludm9rZUFzYXA7XG4gICAgICAgIGludm9rZUFzYXAgPSBmYWxzZTtcbiAgICB9XG5cbiAgICB2YXIgdGltZXI7XG5cbiAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XG4gICAgICAgIGN0eCA9IGN0eCB8fCB0aGlzO1xuXG4gICAgICAgIGludm9rZUFzYXAgJiYgIXRpbWVyICYmIGZuLmFwcGx5KGN0eCwgYXJncyk7XG5cbiAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVyKTtcblxuICAgICAgICB0aW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpbnZva2VBc2FwIHx8IGZuLmFwcGx5KGN0eCwgYXJncyk7XG4gICAgICAgICAgICB0aW1lciA9IG51bGw7XG4gICAgICAgIH0sIHRpbWVvdXQpO1xuXG4gICAgfTtcbn07XG4iLCJ2YXIgZGVib3VuY2UgPSByZXF1aXJlKCcuL2RlYm91bmNlJyksXG4gICAgc2Nyb2xsID0gcmVxdWlyZSgnLi9zY3JvbGwnKTtcblxuKGZ1bmN0aW9uKGRvYywgd2luLCAkLCB1bmRlZmluZWQpIHtcbiAgICB2YXIgJHdpbiA9ICQod2luKTtcblxuICAgIHZhciBQYWdlciA9IGZ1bmN0aW9uKGVsZW0pIHtcbiAgICAgICAgdmFyICRlbGVtID0gJChlbGVtKSxcbiAgICAgICAgICAgICRtb3ZhYmxlID0gJGVsZW0uZmluZCgnLnBhZ2VyX19tb3ZhYmxlJyk7XG5cbiAgICAgICAgaWYgKCRtb3ZhYmxlLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgJG1vdmFibGUgPSAkZWxlbTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuXyRlbGVtID0gJGVsZW07XG4gICAgICAgIHRoaXMuX2l0ZW1zID0gW107XG4gICAgICAgIHRoaXMuX2l0ZW1zQ291bnQgPSAwO1xuICAgICAgICB0aGlzLl9jdXJyZW50SXRlbSA9IG51bGw7XG5cbiAgICAgICAgdGhpcy5hZGRJdGVtcygkbW92YWJsZS5jaGlsZHJlbignYXJ0aWNsZScpKTtcblxuICAgICAgICB0aGlzLl9vblJlc2l6ZSA9IGRlYm91bmNlKHRoaXMuX29uUmVzaXplLCAxMDAsIHRydWUsIHRoaXMpO1xuICAgICAgICB0aGlzLl9vblNjcm9sbCA9IGRlYm91bmNlKHRoaXMuX29uU2Nyb2xsLCA1MDAsIHRydWUsIHRoaXMpO1xuICAgICAgICB0aGlzLl9vblRvdWNoRW5kID0gdGhpcy5fb25Ub3VjaEVuZC5iaW5kKHRoaXMpO1xuICAgICAgICB0aGlzLl9vblRvdWNoU3RhcnQgPSB0aGlzLl9vblRvdWNoU3RhcnQuYmluZCh0aGlzKTtcbiAgICAgICAgdGhpcy5fb25XaGVlbFNjcm9sbCA9IHRoaXMuX29uV2hlZWxTY3JvbGwuYmluZCh0aGlzKTtcblxuICAgICAgICB0aGlzLl9iaW5kRXZlbnRzKHRydWUpO1xuICAgICAgICB0aGlzLl9vblJlc2l6ZSgpO1xuXG4gICAgICAgICR3aW4ub24oJ3Jlc2l6ZScsIHRoaXMuX29uUmVzaXplKTtcblxuICAgICAgICAkZWxlbS5kYXRhKCdwYWdlcicsIHRoaXMpO1xuICAgIH07XG5cbiAgICB2YXIgcGFnZXIgPSBQYWdlci5wcm90b3R5cGU7XG5cbiAgICBwYWdlci5zdGVwID0gZnVuY3Rpb24oZGVsdGEpIHtcbiAgICAgICAgdmFyIGN1cnJlbnRJdGVtID0gdGhpcy5fY3VycmVudEl0ZW0sXG4gICAgICAgICAgICBzdGVwcyA9IGN1cnJlbnRJdGVtLnN0ZXBzLFxuICAgICAgICAgICAgaXNEb3duID0gZGVsdGEgPiAwLFxuICAgICAgICAgICAgbmV4dFN0ZXAsXG4gICAgICAgICAgICBzdGVwO1xuXG4gICAgICAgIGlmIChzdGVwcykge1xuICAgICAgICAgICAgc3RlcCA9IGN1cnJlbnRJdGVtLnN0ZXA7XG4gICAgICAgICAgICBuZXh0U3RlcCA9IHN0ZXAgKyAoaXNEb3duID8gMSA6IC0xKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChuZXh0U3RlcCA+PSAwICYmIG5leHRTdGVwIDw9IHN0ZXBzKSB7XG4gICAgICAgICAgICBjdXJyZW50SXRlbS5zdGVwID0gbmV4dFN0ZXA7XG5cbiAgICAgICAgICAgIHRoaXMuXyRlbGVtLnRyaWdnZXIoJ2NoYW5nZV9zdGVwJywge1xuICAgICAgICAgICAgICAgIGl0ZW06IGN1cnJlbnRJdGVtLFxuICAgICAgICAgICAgICAgIHByZXY6IHN0ZXAsXG4gICAgICAgICAgICAgICAgY3VycmVudDogbmV4dFN0ZXAsXG4gICAgICAgICAgICAgICAgaXNMYXN0OiBuZXh0U3RlcCA9PT0gc3RlcHMsXG4gICAgICAgICAgICAgICAgaXNGaXJzdDogbmV4dFN0ZXAgPT09IDBcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gZGVsdGFcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdXG4gICAgICogQHJldHVybnMge1BhZ2VyfVxuICAgICAqL1xuICAgIHBhZ2VyLm1vdmUgPSBmdW5jdGlvbihkZWx0YSwgb3B0aW9ucykge1xuICAgICAgICB2YXIgb3B0cyA9IG9wdGlvbnMgfHwge30sXG4gICAgICAgICAgICBpdGVtLFxuICAgICAgICAgICAgaXNEb3duLFxuICAgICAgICAgICAgcG9zaXRpb24sXG4gICAgICAgICAgICBjdXJyZW50SXRlbSxcbiAgICAgICAgICAgIGN1cnJlbnRQb3NpdGlvbjtcblxuICAgICAgICBpZiAodGhpcy5pc0Rpc2FibGVkIHx8IHRoaXMuc2Nyb2xsaW5nKSB7XG4gICAgICAgICAgICB0aGlzLl9sYXN0U2Nyb2xsRGVsdGEgPSBkZWx0YTtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZGVsdGEgPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9XG5cbiAgICAgICAgaXNEb3duID0gZGVsdGEgPiAwO1xuICAgICAgICBjdXJyZW50SXRlbSA9IHRoaXMuX2N1cnJlbnRJdGVtO1xuICAgICAgICBjdXJyZW50UG9zaXRpb24gPSB0aGlzLl9jdXJyZW50UG9zaXRpb247XG5cbiAgICAgICAgaWYgKFxuICAgICAgICAgICAgb3B0cy5jaGVja1N0ZXBzICYmIGN1cnJlbnRQb3NpdGlvbiA9PT0gY3VycmVudEl0ZW0uc3RhcnQgJiZcbiAgICAgICAgICAgICggISBvcHRzLmNoZWNrU2Nyb2xsIHx8IHRoaXMuX2lzUmVhbFNjcm9sbChkZWx0YSkpXG4gICAgICAgICkge1xuICAgICAgICAgICAgaWYgKHRoaXMuc3RlcChkZWx0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHBvc2l0aW9uID0gY3VycmVudFBvc2l0aW9uICsgZGVsdGE7XG5cbiAgICAgICAgaWYgKGRlbHRhID4gMCAmJiBjdXJyZW50UG9zaXRpb24gPCBjdXJyZW50SXRlbS53aW5IZWlnaHREaWZmKSB7XG4gICAgICAgICAgICBwb3NpdGlvbiA9IE1hdGgubWluKHBvc2l0aW9uLCBjdXJyZW50SXRlbS53aW5IZWlnaHREaWZmKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZGVsdGEgPCAwICYmIGN1cnJlbnRQb3NpdGlvbiA+IGN1cnJlbnRJdGVtLnN0YXJ0KSB7XG4gICAgICAgICAgICBwb3NpdGlvbiA9IE1hdGgubWF4KHBvc2l0aW9uLCBjdXJyZW50SXRlbS5zdGFydCk7XG4gICAgICAgIH1cblxuICAgICAgICBpdGVtID0gdGhpcy5fZ2V0SXRlbUJ5UG9zaXRpb24ocG9zaXRpb24sIGlzRG93biA/ICdkb3duJyA6ICd1cCcpO1xuXG4gICAgICAgIGlmIChpdGVtICE9PSBjdXJyZW50SXRlbSkge1xuICAgICAgICAgICAgaWYgKCAhIG9wdHMuY2hlY2tTY3JvbGwgfHwgdGhpcy5faXNSZWFsU2Nyb2xsKGRlbHRhKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRQb3NpdGlvbiA9IGl0ZW0uc3RhcnQ7XG5cbiAgICAgICAgICAgICAgICB0aGlzLmdvVG8oaXRlbS5pbmRleCwgdHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl9sYXN0U2Nyb2xsRGVsdGEgPSBkZWx0YTtcbiAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRQb3NpdGlvbiA9IE1hdGgubWF4KGl0ZW0uc3RhcnQsIE1hdGgubWluKHBvc2l0aW9uLCBpdGVtLndpbkhlaWdodERpZmYpKTtcbiAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRJdGVtID0gaXRlbTtcblxuICAgICAgICAgICAgdGhpcy5tb3ZlVG8oe1xuICAgICAgICAgICAgICAgIHRvOiB0aGlzLl9jdXJyZW50UG9zaXRpb24sXG4gICAgICAgICAgICAgICAgZHVyYXRpb246IDBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEByZXR1cm5zIHtQYWdlcn1cbiAgICAgKi9cbiAgICBwYWdlci5wcmV2ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuZ29Ubyh0aGlzLl9jdXJyZW50SXRlbSA/IHRoaXMuX2N1cnJlbnRJdGVtLmluZGV4IC0gMSA6IDApO1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBAcmV0dXJucyB7UGFnZXJ9XG4gICAgICovXG4gICAgcGFnZXIubmV4dCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmdvVG8odGhpcy5fY3VycmVudEl0ZW0gPyB0aGlzLl9jdXJyZW50SXRlbS5pbmRleCArIDEgOiAwKTtcblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQHJldHVybnMge1BhZ2VyfVxuICAgICAqL1xuICAgIHBhZ2VyLmdvVG8gPSBmdW5jdGlvbihpdGVtSW5kZXgsIGlzRm9yY2UpIHtcbiAgICAgICAgdmFyIGN1cnJlbnRJdGVtID0gdGhpcy5nZXRJdGVtKGl0ZW1JbmRleCk7XG5cbiAgICAgICAgaWYgKGN1cnJlbnRJdGVtKSB7XG4gICAgICAgICAgICB0aGlzLnNldEN1cnJlbnRJdGVtKGN1cnJlbnRJdGVtLCBpc0ZvcmNlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge2pRdWVyeX0gJGl0ZW1zXG4gICAgICogQHJldHVybnMge1BhZ2VyfVxuICAgICAqL1xuICAgIHBhZ2VyLmFkZEl0ZW1zID0gZnVuY3Rpb24oJGl0ZW1zKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXMsXG4gICAgICAgICAgICAkc2xpZGU7XG5cbiAgICAgICAgJC5lYWNoKCRpdGVtcywgZnVuY3Rpb24oaW5kLCBzbGlkZSkge1xuICAgICAgICAgICAgJHNsaWRlID0gJChzbGlkZSk7XG5cbiAgICAgICAgICAgIF90aGlzLl9pdGVtc0NvdW50ID0gX3RoaXMuX2l0ZW1zLnB1c2goe1xuICAgICAgICAgICAgICAgIGluZGV4OiBpbmQsXG4gICAgICAgICAgICAgICAgc3RlcDogcGFyc2VJbnQoJHNsaWRlLmRhdGEoJ3N0ZXAnKSwgMTApIHx8IDAsXG4gICAgICAgICAgICAgICAgc3RlcHM6IHBhcnNlSW50KCRzbGlkZS5kYXRhKCdzdGVwcycpLCAxMCkgfHwgMCxcbiAgICAgICAgICAgICAgICAkZWxlbTogJHNsaWRlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge051bWJlcnxTdHJpbmd9IFtpdGVtSW5kZXhdXG4gICAgICogQHJldHVybnMgez9PYmplY3R9XG4gICAgICovXG4gICAgcGFnZXIuZ2V0SXRlbSA9IGZ1bmN0aW9uKGl0ZW1JbmRleCkge1xuICAgICAgICB2YXIgaW5kZXggPSBmYWxzZTtcblxuICAgICAgICBpZiAodHlwZW9mIGl0ZW1JbmRleCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHRoaXMuX2l0ZW1zLnNvbWUoZnVuY3Rpb24oc2xpZGUsIGluZCkge1xuICAgICAgICAgICAgICAgIGlmIChzbGlkZS5pZCA9PT0gaXRlbUluZGV4KSB7XG4gICAgICAgICAgICAgICAgICAgIGluZGV4ID0gaW5kO1xuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICgkLmlzTnVtZXJpYyhpdGVtSW5kZXgpKSB7XG4gICAgICAgICAgICBpbmRleCA9IGl0ZW1JbmRleCA+IC0xICYmIGl0ZW1JbmRleCA8IHRoaXMuX2l0ZW1zQ291bnQgJiYgaXRlbUluZGV4O1xuICAgICAgICB9IGVsc2UgaWYgKCAhIGl0ZW1JbmRleCkge1xuICAgICAgICAgICAgaW5kZXggPSB0aGlzLl9jdXJyZW50SXRlbSAmJiB0aGlzLl9jdXJyZW50SXRlbS5pbmRleDtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiAkLmlzTnVtZXJpYyhpbmRleCkgP1xuICAgICAgICAgICAgdGhpcy5faXRlbXNbaW5kZXhdIDpcbiAgICAgICAgICAgIG51bGw7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbZGlyZWN0aW9uXVxuICAgICAqIEByZXR1cm5zIHtQYWdlcn1cbiAgICAgKi9cbiAgICBwYWdlci51cGRhdGVQb3NpdGlvbiA9IGZ1bmN0aW9uKGRpcmVjdGlvbikge1xuICAgICAgICB2YXIgaXRlbSA9IHRoaXMuX2dldEl0ZW1CeVBvc2l0aW9uKHRoaXMuX2N1cnJlbnRQb3NpdGlvbiwgZGlyZWN0aW9uKTtcblxuICAgICAgICBpZiAoaXRlbSAhPT0gdGhpcy5fY3VycmVudEl0ZW0pIHtcbiAgICAgICAgICAgIHRoaXMuZ29UbyhpdGVtLmluZGV4LCB0cnVlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gY3VycmVudEl0ZW1cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtpc0ZvcmNlXVxuICAgICAqIEByZXR1cm5zIHtQYWdlcn1cbiAgICAgKi9cbiAgICBwYWdlci5zZXRDdXJyZW50SXRlbSA9IGZ1bmN0aW9uKGN1cnJlbnRJdGVtLCBpc0ZvcmNlKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXMsXG4gICAgICAgICAgICBwcmV2SXRlbSA9IF90aGlzLl9jdXJyZW50SXRlbSxcbiAgICAgICAgICAgIGlzQ3VycmVudCA9IGN1cnJlbnRJdGVtID09PSBwcmV2SXRlbTtcblxuICAgICAgICBpZiAoICEgaXNGb3JjZSAmJiBpc0N1cnJlbnQpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCAhIGlzQ3VycmVudCkge1xuICAgICAgICAgICAgLy8gcHJldkl0ZW0gJiYgcHJldkl0ZW0uJGVsZW0ucmVtb3ZlQ2xhc3MoJ2N1cnJlbnQnKTtcblxuICAgICAgICAgICAgX3RoaXMuXyRlbGVtLnRyaWdnZXIoJ2NoYW5nZV9zdGFydCcsIHtcbiAgICAgICAgICAgICAgICBuZXh0OiBjdXJyZW50SXRlbSxcbiAgICAgICAgICAgICAgICBjdXJyZW50OiBwcmV2SXRlbVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBfdGhpc1xuICAgICAgICAgICAgLm1vdmVUbyh7IHRvOiBjdXJyZW50SXRlbS5zdGFydCB9KVxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKCAhIGlzQ3VycmVudCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBjdXJyZW50SXRlbS4kZWxlbS5hZGRDbGFzcygnY3VycmVudCcpO1xuXG4gICAgICAgICAgICAgICAgICAgIF90aGlzLl9jdXJyZW50SXRlbSA9IGN1cnJlbnRJdGVtO1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5fJGVsZW1cbiAgICAgICAgICAgICAgICAgICAgICAgIC50cmlnZ2VyKCdjaGFuZ2VfZG9uZScsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmV2OiBwcmV2SXRlbSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50OiBjdXJyZW50SXRlbVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRzXG4gICAgICogQHJldHVybiB7P2pRdWVyeS5EZWZlcnJlZH1cbiAgICAgKi9cbiAgICBwYWdlci5tb3ZlVG8gPSBmdW5jdGlvbihvcHRzKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgICAgICAgaWYgKF90aGlzLnNjcm9sbGluZykge1xuICAgICAgICAgICAgX3RoaXMuc2Nyb2xsaW5nLnJlamVjdCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgX3RoaXMuc2Nyb2xsaW5nID0gc2Nyb2xsKF90aGlzLl8kZWxlbSwgb3B0cyk7XG5cbiAgICAgICAgX3RoaXMuc2Nyb2xsaW5nXG4gICAgICAgICAgICAuYWx3YXlzKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLnNjcm9sbGluZyA9IG51bGw7XG4gICAgICAgICAgICAgICAgfSwgMCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gX3RoaXMuc2Nyb2xsaW5nO1xuICAgIH07XG5cbiAgICBwYWdlci5kaXNhYmxlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuaXNEaXNhYmxlZCA9IHRydWU7XG4gICAgfTtcblxuICAgIHBhZ2VyLmVuYWJsZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmlzRGlzYWJsZWQgPSBmYWxzZTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW3Bvc2l0aW9uXSDQn9C+0LfQuNGG0LjRj1xuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbZGlyZWN0aW9uXSDQndCw0L/RgNCw0LLQu9C10L3QuNC1XG4gICAgICogQHJldHVybnMgez9PYmplY3R9INCQ0LnRgtC10LwsINGB0L7QvtGC0LLQtdGC0YHRgtCy0YPRjtGJ0LjQuSDQv9C+0LfQuNGG0LjQuFxuICAgICAqL1xuICAgIHBhZ2VyLl9nZXRJdGVtQnlQb3NpdGlvbiA9IGZ1bmN0aW9uKHBvc2l0aW9uLCBkaXJlY3Rpb24pIHtcbiAgICAgICAgdmFyIHN0YXJ0ID0gcG9zaXRpb24gfHwgdGhpcy5fY3VycmVudFBvc2l0aW9uLFxuICAgICAgICAgICAgZW5kID0gc3RhcnQgKyB0aGlzLndpblNpemUuaGVpZ2h0LFxuICAgICAgICAgICAgaXRlbXMgPSB0aGlzLl9pdGVtcyxcbiAgICAgICAgICAgIGl0ZW1zTGVuID0gdGhpcy5faXRlbXNDb3VudCxcbiAgICAgICAgICAgIGNoZWNraW5nSW5kZXggPSAwLFxuICAgICAgICAgICAgb2Zmc2V0LFxuICAgICAgICAgICAgaXRlbTtcblxuICAgICAgICB3aGlsZSAoKGl0ZW0gPSBpdGVtc1tjaGVja2luZ0luZGV4KytdKSkge1xuICAgICAgICAgICAgb2Zmc2V0ID0gc3RhcnQgLSBpdGVtLnN0YXJ0O1xuXG4gICAgICAgICAgICBpZiAoICEgZGlyZWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0uaGVpZ2h0IC8gMiA+PSBvZmZzZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAoZGlyZWN0aW9uID09PSAnZG93bicgJiYgaXRlbS5zdGFydCA8PSBlbmQgJiYgaXRlbS5lbmQgPj0gZW5kKSB7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChkaXJlY3Rpb24gPT09ICd1cCcgJiYgaXRlbS5lbmQgPiBzdGFydCkge1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoICEgaXRlbSkge1xuICAgICAgICAgICAgaXRlbSA9IGRpcmVjdGlvbiA9PT0gJ2Rvd24nID8gaXRlbXNbaXRlbXNMZW4gLSAxXSA6IGl0ZW1zWzBdO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGl0ZW07XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBpc09uXG4gICAgICovXG4gICAgcGFnZXIuX2JpbmRFdmVudHMgPSBmdW5jdGlvbihpc09uKSB7XG4gICAgICAgIHRoaXMuXyRlbGVtW2lzT24gPyAnb24nIDogJ29mZiddKHRydWUgfHwgKCdvbnRvdWNoc3RhcnQnIGluIGRvYy5kb2N1bWVudEVsZW1lbnQpID9cbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB0b3VjaGVuZDogdGhpcy5fb25Ub3VjaEVuZCxcbiAgICAgICAgICAgICAgICB0b3VjaHN0YXJ0OiB0aGlzLl9vblRvdWNoU3RhcnQsXG4gICAgICAgICAgICAgICAgc2Nyb2xsOiBmdW5jdGlvbihlKSB7IGUucHJldmVudERlZmF1bHQoKTsgZS5zdG9wUHJvcGFnYXRpb24oKTsgcmV0dXJuIGZhbHNlOyB9XG4gICAgICAgICAgICB9IDpcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB3aGVlbDogdGhpcy5fb25XaGVlbFNjcm9sbCxcbiAgICAgICAgICAgICAgICBzY3JvbGw6IHRoaXMuX29uU2Nyb2xsXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAkKCcucGFnZXJfX25hdl9kaXJfbmV4dCcpLmNsaWNrKHRoaXMubmV4dC5iaW5kKHRoaXMpKTtcbiAgICAgICAgJCgnLnBhZ2VyX19uYXZfZGlyX3ByZXYnKS5jbGljayh0aGlzLnByZXYuYmluZCh0aGlzKSk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IG5ld0RlbHRhXG4gICAgICogQHJldHVybnMge0Jib29sZWFufVxuICAgICAqL1xuICAgIHBhZ2VyLl9pc1JlYWxTY3JvbGwgPSBmdW5jdGlvbihuZXdEZWx0YSkge1xuICAgICAgICB2YXIgb2xkRGVsdGEgPSB0aGlzLl9sYXN0U2Nyb2xsRGVsdGEsXG4gICAgICAgICAgICBpc1JlYWxTY3JvbGwgPSBmYWxzZTtcblxuICAgICAgICBpZiAob2xkRGVsdGEgIT09IG51bGwpIHtcbiAgICAgICAgICAgIC8vIGRpZmZlcmVudCBkaXJlY3Rpb25cbiAgICAgICAgICAgIGlmIChvbGREZWx0YSA8IDAgJiYgbmV3RGVsdGEgPiAwKSB7XG4gICAgICAgICAgICAgICAgaXNSZWFsU2Nyb2xsID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChvbGREZWx0YSA+IDAgJiYgbmV3RGVsdGEgPCAwKSB7XG4gICAgICAgICAgICAgICAgaXNSZWFsU2Nyb2xsID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIHNhbWUgZGlyZWN0aW9uXG4gICAgICAgICAgICBpZiAob2xkRGVsdGEgPiAwICYmIG5ld0RlbHRhID4gMCkge1xuICAgICAgICAgICAgICAgIGlzUmVhbFNjcm9sbCA9IG9sZERlbHRhIDwgbmV3RGVsdGE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAob2xkRGVsdGEgPCAwICYmIG5ld0RlbHRhIDwgMCkge1xuICAgICAgICAgICAgICAgIGlzUmVhbFNjcm9sbCA9IG9sZERlbHRhID4gbmV3RGVsdGE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpc1JlYWxTY3JvbGwgPSB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5fbGFzdFNjcm9sbERlbHRhID0gbmV3RGVsdGE7XG5cbiAgICAgICAgcmV0dXJuIGlzUmVhbFNjcm9sbDtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge2pRdWVyeS5FdmVudH0gZXZlbnRcbiAgICAgKi9cbiAgICBwYWdlci5fb25XaGVlbFNjcm9sbCA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgIHZhciBlID0gZXZlbnQub3JpZ2luYWxFdmVudCB8fCB3aW5kb3cuZXZlbnQ7XG5cbiAgICAgICAgaWYgKE1hdGguYWJzKGUuZGVsdGFZKSA8IE1hdGguYWJzKGUuZGVsdGFYKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5tb3ZlKGUuZGVsdGFZLCB7XG4gICAgICAgICAgICBjaGVja1Njcm9sbDogdHJ1ZSxcbiAgICAgICAgICAgIGNoZWNrU3RlcHM6IHRydWVcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7alF1ZXJ5LkV2ZW50fSBldmVudFxuICAgICAqL1xuICAgIHBhZ2VyLl9vblRvdWNoU3RhcnQgPSBmdW5jdGlvbihldmVudCkge1xuICAgICAgICB2YXIgdG91Y2hlcyA9IGV2ZW50Lm9yaWdpbmFsRXZlbnQudGFyZ2V0VG91Y2hlcztcblxuICAgICAgICAvLyDQuNCz0L3QvtGA0LjQvCDQtdGB0LvQuCDQvdCwINGN0LrRgNCw0L3QtSDRgdC70LjRiNC60L7QvCDQvNC90L7Qs9C+INC/0LDQu9GM0YbQtdCyXG4gICAgICAgIGlmICh0b3VjaGVzICYmIHRvdWNoZXMubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5fdG91Y2hTdGFydCA9IHRvdWNoZXMgPyB0b3VjaGVzWzBdIDogZXZlbnQub3JpZ2luYWxFdmVudDtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge2pRdWVyeS5FdmVudH0gZXZlbnRcbiAgICAgKi9cbiAgICBwYWdlci5fb25Ub3VjaEVuZCA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgIHZhciB0b3VjaGVzID0gZXZlbnQub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlcyxcbiAgICAgICAgICAgIGN1cnJlbnRUb3VjaCA9IHRvdWNoZXMgPyB0b3VjaGVzWzBdIDogZXZlbnQub3JpZ2luYWxFdmVudDtcblxuICAgICAgICB0aGlzLm1vdmUodGhpcy5fdG91Y2hTdGFydC5wYWdlWSAtIGN1cnJlbnRUb3VjaC5wYWdlWSk7XG5cbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIHBhZ2VyLl9vblNjcm9sbCA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ3Njcm9sbCcsIGV2ZW50LCB0aGlzLl8kZWxlbS5zY3JvbGxUb3AoKSwgdGhpcy5fY3VycmVudFBvc2l0aW9uKTtcblxuICAgICAgICB0aGlzLm1vdmUodGhpcy5fJGVsZW0uc2Nyb2xsVG9wKCkgLSB0aGlzLl9jdXJyZW50UG9zaXRpb24pO1xuXG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBwYWdlci5fb25SZXNpemUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHdpbkhlaWdodCA9ICR3aW4uaGVpZ2h0KCksXG4gICAgICAgICAgICBsYXN0RW5kID0gMDtcblxuICAgICAgICB0aGlzLl9pdGVtcy5mb3JFYWNoKGZ1bmN0aW9uKHNsaWRlKSB7XG4gICAgICAgICAgICBzbGlkZS5oZWlnaHQgPSBzbGlkZS4kZWxlbS5vdXRlckhlaWdodCgpO1xuICAgICAgICAgICAgc2xpZGUuc3RhcnQgPSBsYXN0RW5kO1xuICAgICAgICAgICAgc2xpZGUuZW5kID0gKGxhc3RFbmQgKz0gc2xpZGUuaGVpZ2h0KTtcbiAgICAgICAgICAgIHNsaWRlLndpbkhlaWdodERpZmYgPSBzbGlkZS5lbmQgLSB3aW5IZWlnaHQ7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMud2luU2l6ZSB8fCAodGhpcy53aW5TaXplID0ge30pO1xuICAgICAgICB0aGlzLndpblNpemUuaGVpZ2h0ID0gd2luSGVpZ2h0O1xuXG4gICAgICAgIHRoaXMuX2N1cnJlbnRQb3NpdGlvbiA9IHRoaXMuXyRlbGVtLnNjcm9sbFRvcCgpO1xuXG4gICAgICAgIHRoaXMudXBkYXRlUG9zaXRpb24oKTtcbiAgICB9O1xuXG4gICAgJC5mbi5wYWdlciA9IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5lYWNoKGZ1bmN0aW9uKGluZCwgZWxlbSkge1xuICAgICAgICAgICAgLyoganNoaW50IC1XMDMxICovXG4gICAgICAgICAgICBuZXcgUGFnZXIoZWxlbSwgb3B0aW9ucyk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbn0pKGRvY3VtZW50LCB3aW5kb3csIGpRdWVyeSk7XG4iLCJtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKCRlbGVtLCBvcHRpb25zKSB7XG4gICAgdmFyIG9wdHMgPSBvcHRpb25zIHx8IHt9LFxuICAgICAgICB0byA9IHBhcnNlSW50KG9wdGlvbnMudG8sIDEwKSxcbiAgICAgICAgZHVyYXRpb24gPSBwYXJzZUludChvcHRzLmR1cmF0aW9uLCAxMCksXG4gICAgICAgIGRlZmYgPSAkLkRlZmVycmVkKCksXG4gICAgICAgIGVhc2luZztcblxuICAgIGlmIChpc05hTihkdXJhdGlvbikpIHtcbiAgICAgICAgZHVyYXRpb24gPSBNYXRoLnNxcnQoTWF0aC5hYnMoJGVsZW0uc2Nyb2xsVG9wKCkgLSB0bykpICogNDA7XG4gICAgfVxuXG4gICAgaWYgKGR1cmF0aW9uID4gMCkge1xuICAgICAgICBlYXNpbmcgPSBvcHRzLmVhc2luZztcblxuICAgICAgICBpZiAodHlwZW9mIGVhc2luZyAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIGVhc2luZyA9ICdlYXNlT3V0Q3ViaWMnO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2YgJC5lYXNpbmdbZWFzaW5nXSAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgZWFzaW5nID0gJ2xpbmVhcic7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAkZWxlbVxuICAgICAgICAuc3RvcCgpXG4gICAgICAgIC5hbmltYXRlKFxuICAgICAgICAgICAgeyBzY3JvbGxUb3A6IHRvIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZHVyYXRpb246IGR1cmF0aW9uLFxuICAgICAgICAgICAgICAgIGVhc2luZzogZWFzaW5nLFxuICAgICAgICAgICAgICAgIHF1ZXVlOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBkb25lOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVmZi5yZXNvbHZlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICByZXR1cm4gZGVmZjtcbn07XG4iXX0="}