{"version":3,"sources":["js/node_modules/browser-pack/_prelude.js","js/src/js/entry.js","js/src/js/lib/debounce.js","js/src/js/lib/pager.js","js/src/js/lib/scroll.js"],"names":[],"mappings":"AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACzCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACxBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACrgBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"bundle.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","require('./lib/pager');\n\n$(function() {\n    var $pager = $('.pager'),\n        $video = $('.pager__page').eq(0),\n        $screens = $('.screens'),\n        video = $video.data('vide').getVideoObject(),\n        pager;\n\n    $pager.pager();\n    pager = $pager.data('pager');\n\n    $('.screens__nav_dir_next').on('tap', function() {\n        pager.step(1);\n    });\n    $('.screens__nav_dir_prev').on('tap', function() {\n        pager.step(-1);\n    });\n\n    $pager\n        .on('change_start', function() {\n            video.pause();\n        })\n        .on('change_done', function(e, data) {\n            if (data.current.$elem.is($video)) {\n                video.play();\n            }\n        })\n        .on('change_step', function(e, data) {\n            pager.disable();\n\n            $screens\n                .removeClass('screens_step_' + data.prev)\n                .addClass('screens_step_' + data.current);\n\n            setTimeout(function() {\n                pager.enable();\n            }, data.isFirst || data.isLast ? 1100 : 900);\n        });\n\n});\n","module.exports = function(fn, timeout, invokeAsap, ctx) {\n    if(arguments.length == 3 && typeof invokeAsap != 'boolean') {\n        ctx = invokeAsap;\n        invokeAsap = false;\n    }\n\n    var timer;\n\n    return function() {\n\n        var args = arguments;\n        ctx = ctx || this;\n\n        invokeAsap && !timer && fn.apply(ctx, args);\n\n        clearTimeout(timer);\n\n        timer = setTimeout(function() {\n            invokeAsap || fn.apply(ctx, args);\n            timer = null;\n        }, timeout);\n\n    };\n};\n","(function(doc, win, $, undefined) {\n    var debounce = require('./debounce'),\n        scroll = require('./scroll');\n\n    var isTouch = 'ontouchstart' in doc.documentElement;\n\n    var $win = $(win);\n\n    var Pager = function(elem) {\n        var $elem = $(elem),\n            $movable = $elem.find('.pager__movable');\n\n        if ($movable.length === 0) {\n            $movable = $elem;\n        }\n\n        this._$elem = $elem;\n        this._items = [];\n        this._itemsCount = 0;\n        this._currentItem = null;\n\n        this.addItems($movable.children('article'));\n\n        this._onResize = debounce(this._onResize, true, 100, this);\n        this._onScroll = debounce(this._onScroll, true, 500, this);\n        this._onTouchEnd = this._onTouchEnd.bind(this);\n        this._onTouchStart = this._onTouchStart.bind(this);\n        this._onWheelScroll = this._onWheelScroll.bind(this);\n\n        this._bindEvents(true);\n        this._onResize();\n\n        $win.on('resize orientationchange load', this._onResize);\n\n        $elem.data('pager', this);\n    };\n\n    var pager = Pager.prototype;\n\n    pager.step = function(diff) {\n        var currentItem = this._currentItem,\n            steps = currentItem.steps,\n            nextStep,\n            step;\n\n        if (steps) {\n            step = currentItem.step;\n            nextStep = step + diff;\n\n            if (nextStep >= 0 && nextStep <= (steps + (isTouch ? -1 : 0))) {\n                currentItem.step = nextStep;\n\n                this._$elem.trigger('change_step', {\n                    item: currentItem,\n                    prev: step,\n                    current: nextStep,\n                    isLast: nextStep === steps,\n                    isFirst: nextStep === 0\n                });\n\n                return true;\n            }\n        }\n    };\n\n    /**\n     * @param {Number} delta\n     * @param {Object} [options]\n     * @returns {Pager}\n     */\n    pager.move = function(delta, options) {\n        var opts = options || {},\n            item,\n            isDown,\n            position,\n            isRealScroll,\n            currentItem,\n            currentPosition;\n\n        if (this.isDisabled || this.scrolling) {\n            this._lastScrollDelta = delta;\n\n            return this;\n        }\n\n        if (delta === 0) {\n            return this;\n        }\n\n        isDown = delta > 0;\n        isRealScroll = ! opts.checkScroll || this._isRealScroll(delta);\n        currentItem = this._currentItem;\n        currentPosition = this._currentPosition;\n\n        if (\n            isRealScroll &&\n            opts.checkSteps &&\n            Math.abs(currentPosition - currentItem.start) < 50\n        ) {\n            if (this.step(isDown ? 1 : -1)) {\n                return this;\n            }\n        }\n\n        position = opts.position;\n\n        if (typeof position !== 'number') {\n            position = currentPosition + delta;\n\n            if (delta > 0 && currentPosition < currentItem.winHeightDiff) {\n                position = Math.min(position, currentItem.winHeightDiff);\n            }\n            if (delta < 0 && currentPosition > currentItem.start) {\n                position = Math.max(position, currentItem.start);\n            }\n        }\n\n        item = this._getItemByPosition(position, isDown ? 'down' : 'up', Boolean(opts.position));\n\n        if (item !== currentItem) {\n            if (isRealScroll) {\n                this._currentPosition = item.start;\n\n                this.goTo(item.index, true);\n            }\n        } else {\n            this._lastScrollDelta = delta;\n            this._currentPosition = Math.max(item.start, Math.min(position, item.winHeightDiff));\n            this._currentItem = item;\n\n            this.moveTo({\n                to: this._currentPosition,\n                duration: opts.position ? 100 : 0\n            });\n        }\n\n        return this;\n    };\n\n    /**\n     * @returns {Pager}\n     */\n    pager.prev = function() {\n        this.goTo(this._currentItem ? this._currentItem.index - 1 : 0);\n\n        return this;\n    };\n\n    /**\n     * @returns {Pager}\n     */\n    pager.next = function() {\n        this.goTo(this._currentItem ? this._currentItem.index + 1 : 0);\n\n        return this;\n    };\n\n    /**\n     * @returns {Pager}\n     */\n    pager.goTo = function(itemIndex, isForce) {\n        var currentItem = this.getItem(itemIndex);\n\n        if (currentItem) {\n            this.setCurrentItem(currentItem, isForce);\n        }\n\n        return this;\n    };\n\n    /**\n     * @param {jQuery} $items\n     * @returns {Pager}\n     */\n    pager.addItems = function($items) {\n        var _this = this,\n            $slide;\n\n        $.each($items, function(ind, slide) {\n            $slide = $(slide);\n\n            _this._itemsCount = _this._items.push({\n                index: ind,\n                step: parseInt($slide.data('step'), 10) || 0,\n                steps: parseInt($slide.data('steps'), 10) || 0,\n                $elem: $slide\n            });\n        });\n\n        return _this;\n    };\n\n    /**\n     * @param {Number|String} [itemIndex]\n     * @returns {?Object}\n     */\n    pager.getItem = function(itemIndex) {\n        var index = false;\n\n        if (typeof itemIndex === 'string') {\n            this._items.some(function(slide, ind) {\n                if (slide.id === itemIndex) {\n                    index = ind;\n\n                    return false;\n                }\n            });\n        }\n\n        if ($.isNumeric(itemIndex)) {\n            index = itemIndex > -1 && itemIndex < this._itemsCount && itemIndex;\n        } else if ( ! itemIndex) {\n            index = this._currentItem && this._currentItem.index;\n        }\n\n        return $.isNumeric(index) ?\n            this._items[index] :\n            null;\n    };\n\n    /**\n     * @param {String} [direction]\n     * @returns {Pager}\n     */\n    pager.updatePosition = function(direction) {\n        var item = this._getItemByPosition(this._currentPosition, direction);\n\n        if (item !== this._currentItem) {\n            this.goTo(item.index, true);\n        }\n\n        return this;\n    };\n\n    /**\n     * @param {Object} currentItem\n     * @param {Boolean} [isForce]\n     * @returns {Pager}\n     */\n    pager.setCurrentItem = function(currentItem, isForce) {\n        var _this = this,\n            prevItem = _this._currentItem,\n            isCurrent = currentItem === prevItem;\n\n        if ( ! isForce && isCurrent) {\n            return this;\n        }\n\n        if ( ! isCurrent) {\n            // prevItem && prevItem.$elem.removeClass('current');\n\n            _this._$elem.trigger('change_start', {\n                next: currentItem,\n                current: prevItem\n            });\n        }\n\n        _this\n            .moveTo({ to: currentItem.start })\n            .then(function() {\n                if ( ! isCurrent) {\n                    // currentItem.$elem.addClass('current');\n\n                    _this._currentItem = currentItem;\n                    _this._$elem\n                        .trigger('change_done', {\n                            prev: prevItem,\n                            current: currentItem\n                        });\n                }\n            });\n\n        return this;\n    };\n\n    /**\n     * @param {Object} opts\n     * @return {?jQuery.Deferred}\n     */\n    pager.moveTo = function(opts) {\n        var _this = this;\n\n        if (_this.scrolling) {\n            _this.scrolling.reject();\n        }\n\n        _this.scrolling = scroll(_this._$elem, opts);\n\n        _this.scrolling\n            .always(function() {\n                setTimeout(function() {\n                    _this.scrolling = null;\n                }, 0);\n            });\n\n        return _this.scrolling;\n    };\n\n    pager.disable = function() {\n        this.isDisabled = true;\n    };\n\n    pager.enable = function() {\n        this.isDisabled = false;\n    };\n\n    /**\n     * @private\n     * @param {Number} [position] Позиция\n     * @param {String} [direction] Направление\n     * @returns {?Object} Айтем, соответствующий позиции\n     */\n    pager._getItemByPosition = function(position, direction, withBounce) {\n        var start = position || this._currentPosition,\n            end = start + this.winSize.height,\n            items = this._items,\n            itemsLen = this._itemsCount,\n            checkingIndex = 0,\n            offset,\n            item;\n\n        while ((item = items[checkingIndex++])) {\n            offset = start - item.start;\n\n            if ( ! direction) {\n                if (item.halfHeight >= offset) {\n                    break;\n                }\n            } else {\n                if (\n                    direction === 'down' &&\n                    item[withBounce ? 'qStart' : 'start'] <= end &&\n                    item[withBounce ? 'qEnd' : 'end'] >= end\n                ) {\n                    break;\n                }\n\n                if (direction === 'up' && item[withBounce ? 'qsEnd' : 'end'] > start) {\n                    break;\n                }\n            }\n        }\n\n        if ( ! item) {\n            item = direction === 'down' ? items[itemsLen - 1] : items[0];\n        }\n\n        return item;\n    };\n\n    /**\n     * @private\n     * @param {Boolean} isOn\n     */\n    pager._bindEvents = function(isOn) {\n        $('.pager__nav_dir_next')[isOn ? 'on' : 'off'](isTouch ? 'tap' : 'click', this.next.bind(this));\n\n        this._$elem[isOn ? 'on' : 'off'](isTouch ?\n            {\n                touchend: this._onTouchEnd,\n                touchstart: this._onTouchStart\n            } :\n            {\n                wheel: this._onWheelScroll,\n                scroll: this._onScroll\n            });\n    };\n\n    /**\n     * @private\n     * @param {Number} newDelta\n     * @returns {Bboolean}\n     */\n    pager._isRealScroll = function(newDelta) {\n        var oldDelta = this._lastScrollDelta,\n            isRealScroll = false;\n\n        if (navigator.userAgent.indexOf('Mac') === -1) {\n            return true;\n        }\n\n        if (oldDelta !== null) {\n            // different direction\n            if (oldDelta < 0 && newDelta > 0) {\n                isRealScroll = true;\n            }\n            if (oldDelta > 0 && newDelta < 0) {\n                isRealScroll = true;\n            }\n            // same direction\n            if (oldDelta > 0 && newDelta > 0) {\n                isRealScroll = oldDelta < newDelta;\n            }\n            if (oldDelta < 0 && newDelta < 0) {\n                isRealScroll = oldDelta > newDelta;\n            }\n        } else {\n            isRealScroll = true;\n        }\n\n        this._lastScrollDelta = newDelta;\n\n        return isRealScroll;\n    };\n\n    /**\n     * @private\n     * @param {jQuery.Event} event\n     */\n    pager._onWheelScroll = function(event) {\n        var e = event.originalEvent || window.event;\n\n        if (Math.abs(e.deltaY) < Math.abs(e.deltaX)) {\n            return;\n        }\n\n        this.move(e.deltaY, {\n            checkScroll: true,\n            checkSteps: true\n        });\n\n        event.preventDefault();\n        event.stopPropagation();\n\n        return false;\n    };\n\n    /**\n     * @private\n     * @param {jQuery.Event} event\n     */\n    pager._onTouchStart = function(event) {\n        var touches,\n            touch = true;\n\n        if (event.isDefaultPrevented()) {\n            touch = null;\n        }\n\n        touches = touch && event.originalEvent.targetTouches;\n\n        // игнорим если на экране слишком много пальцев\n        if (touches && touches.length > 1) {\n            touch = null;\n        }\n\n        this._touchStart = touch && (touches ? touches[0] : event.originalEvent);\n    };\n\n    /**\n     * @private\n     * @param {jQuery.Event} event\n     */\n    pager._onTouchEnd = function(event) {\n        if (this._touchStart === null) {\n            return;\n        }\n\n        var touches = event.originalEvent.changedTouches,\n            currentTouch = touches ? touches[0] : event.originalEvent;\n\n        this.move(this._touchStart.pageY - currentTouch.pageY, {\n            position: this._$elem.scrollTop()\n        });\n\n        event.preventDefault();\n        event.stopPropagation();\n\n        return false;\n    };\n\n    /**\n     * @private\n     */\n    pager._onScroll = function(event) {\n        this.scrolling || this.move(this._$elem.scrollTop() - this._currentPosition);\n\n        event.preventDefault();\n        event.stopPropagation();\n\n        return false;\n    };\n\n    /**\n     * @private\n     */\n    pager._onResize = function() {\n        var winHeight = $win.height(),\n            lastEnd = 0;\n\n        this._items.forEach(function(item) {\n            item.height = item.$elem.outerHeight();\n            item.halfHeight = item.height / 2;\n            item.start = lastEnd;\n            item.end = (lastEnd += item.height);\n            item.qStart = item.start + item.height / 10;\n            item.qEnd = item.end + item.height / 10;\n            item.qsEnd = item.end - item.height / 10;\n            item.winHeightDiff = item.end - winHeight;\n        });\n\n        this.winSize || (this.winSize = {});\n        this.winSize.height = winHeight;\n\n        this._currentPosition = this._$elem.scrollTop();\n\n        this.updatePosition();\n    };\n\n    $.fn.pager = function(options) {\n        this.each(function(ind, elem) {\n            /* jshint -W031 */\n            new Pager(elem, options);\n        });\n    };\n\n})(document, window, jQuery);\n","module.exports = function($elem, options) {\n    var opts = options || {},\n        to = parseInt(options.to, 10),\n        duration = parseInt(opts.duration, 10),\n        deff = $.Deferred(),\n        easing;\n\n    if (isNaN(duration)) {\n        duration = Math.sqrt(Math.abs($elem.scrollTop() - to)) * 40;\n    }\n\n    if (duration > 0) {\n        easing = opts.easing;\n\n        if (typeof easing !== 'string') {\n            easing = 'easeOutCubic';\n        }\n        if (typeof $.easing[easing] !== 'function') {\n            easing = 'linear';\n        }\n    }\n\n    $elem\n        .stop()\n        .animate(\n            { scrollTop: to },\n            {\n                duration: duration,\n                easing: easing,\n                queue: false,\n                done: function() {\n                    deff.resolve();\n                }\n            });\n\n    return deff;\n};\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvanMvZW50cnkuanMiLCJzcmMvanMvbGliL2RlYm91bmNlLmpzIiwic3JjL2pzL2xpYi9wYWdlci5qcyIsInNyYy9qcy9saWIvc2Nyb2xsLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3pDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN4QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyZ0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwicmVxdWlyZSgnLi9saWIvcGFnZXInKTtcblxuJChmdW5jdGlvbigpIHtcbiAgICB2YXIgJHBhZ2VyID0gJCgnLnBhZ2VyJyksXG4gICAgICAgICR2aWRlbyA9ICQoJy5wYWdlcl9fcGFnZScpLmVxKDApLFxuICAgICAgICAkc2NyZWVucyA9ICQoJy5zY3JlZW5zJyksXG4gICAgICAgIHZpZGVvID0gJHZpZGVvLmRhdGEoJ3ZpZGUnKS5nZXRWaWRlb09iamVjdCgpLFxuICAgICAgICBwYWdlcjtcblxuICAgICRwYWdlci5wYWdlcigpO1xuICAgIHBhZ2VyID0gJHBhZ2VyLmRhdGEoJ3BhZ2VyJyk7XG5cbiAgICAkKCcuc2NyZWVuc19fbmF2X2Rpcl9uZXh0Jykub24oJ3RhcCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICBwYWdlci5zdGVwKDEpO1xuICAgIH0pO1xuICAgICQoJy5zY3JlZW5zX19uYXZfZGlyX3ByZXYnKS5vbigndGFwJywgZnVuY3Rpb24oKSB7XG4gICAgICAgIHBhZ2VyLnN0ZXAoLTEpO1xuICAgIH0pO1xuXG4gICAgJHBhZ2VyXG4gICAgICAgIC5vbignY2hhbmdlX3N0YXJ0JywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2aWRlby5wYXVzZSgpO1xuICAgICAgICB9KVxuICAgICAgICAub24oJ2NoYW5nZV9kb25lJywgZnVuY3Rpb24oZSwgZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEuY3VycmVudC4kZWxlbS5pcygkdmlkZW8pKSB7XG4gICAgICAgICAgICAgICAgdmlkZW8ucGxheSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgICAub24oJ2NoYW5nZV9zdGVwJywgZnVuY3Rpb24oZSwgZGF0YSkge1xuICAgICAgICAgICAgcGFnZXIuZGlzYWJsZSgpO1xuXG4gICAgICAgICAgICAkc2NyZWVuc1xuICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcygnc2NyZWVuc19zdGVwXycgKyBkYXRhLnByZXYpXG4gICAgICAgICAgICAgICAgLmFkZENsYXNzKCdzY3JlZW5zX3N0ZXBfJyArIGRhdGEuY3VycmVudCk7XG5cbiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcGFnZXIuZW5hYmxlKCk7XG4gICAgICAgICAgICB9LCBkYXRhLmlzRmlyc3QgfHwgZGF0YS5pc0xhc3QgPyAxMTAwIDogOTAwKTtcbiAgICAgICAgfSk7XG5cbn0pO1xuIiwibW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihmbiwgdGltZW91dCwgaW52b2tlQXNhcCwgY3R4KSB7XG4gICAgaWYoYXJndW1lbnRzLmxlbmd0aCA9PSAzICYmIHR5cGVvZiBpbnZva2VBc2FwICE9ICdib29sZWFuJykge1xuICAgICAgICBjdHggPSBpbnZva2VBc2FwO1xuICAgICAgICBpbnZva2VBc2FwID0gZmFsc2U7XG4gICAgfVxuXG4gICAgdmFyIHRpbWVyO1xuXG4gICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzO1xuICAgICAgICBjdHggPSBjdHggfHwgdGhpcztcblxuICAgICAgICBpbnZva2VBc2FwICYmICF0aW1lciAmJiBmbi5hcHBseShjdHgsIGFyZ3MpO1xuXG4gICAgICAgIGNsZWFyVGltZW91dCh0aW1lcik7XG5cbiAgICAgICAgdGltZXIgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaW52b2tlQXNhcCB8fCBmbi5hcHBseShjdHgsIGFyZ3MpO1xuICAgICAgICAgICAgdGltZXIgPSBudWxsO1xuICAgICAgICB9LCB0aW1lb3V0KTtcblxuICAgIH07XG59O1xuIiwiKGZ1bmN0aW9uKGRvYywgd2luLCAkLCB1bmRlZmluZWQpIHtcbiAgICB2YXIgZGVib3VuY2UgPSByZXF1aXJlKCcuL2RlYm91bmNlJyksXG4gICAgICAgIHNjcm9sbCA9IHJlcXVpcmUoJy4vc2Nyb2xsJyk7XG5cbiAgICB2YXIgaXNUb3VjaCA9ICdvbnRvdWNoc3RhcnQnIGluIGRvYy5kb2N1bWVudEVsZW1lbnQ7XG5cbiAgICB2YXIgJHdpbiA9ICQod2luKTtcblxuICAgIHZhciBQYWdlciA9IGZ1bmN0aW9uKGVsZW0pIHtcbiAgICAgICAgdmFyICRlbGVtID0gJChlbGVtKSxcbiAgICAgICAgICAgICRtb3ZhYmxlID0gJGVsZW0uZmluZCgnLnBhZ2VyX19tb3ZhYmxlJyk7XG5cbiAgICAgICAgaWYgKCRtb3ZhYmxlLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgJG1vdmFibGUgPSAkZWxlbTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuXyRlbGVtID0gJGVsZW07XG4gICAgICAgIHRoaXMuX2l0ZW1zID0gW107XG4gICAgICAgIHRoaXMuX2l0ZW1zQ291bnQgPSAwO1xuICAgICAgICB0aGlzLl9jdXJyZW50SXRlbSA9IG51bGw7XG5cbiAgICAgICAgdGhpcy5hZGRJdGVtcygkbW92YWJsZS5jaGlsZHJlbignYXJ0aWNsZScpKTtcblxuICAgICAgICB0aGlzLl9vblJlc2l6ZSA9IGRlYm91bmNlKHRoaXMuX29uUmVzaXplLCB0cnVlLCAxMDAsIHRoaXMpO1xuICAgICAgICB0aGlzLl9vblNjcm9sbCA9IGRlYm91bmNlKHRoaXMuX29uU2Nyb2xsLCB0cnVlLCA1MDAsIHRoaXMpO1xuICAgICAgICB0aGlzLl9vblRvdWNoRW5kID0gdGhpcy5fb25Ub3VjaEVuZC5iaW5kKHRoaXMpO1xuICAgICAgICB0aGlzLl9vblRvdWNoU3RhcnQgPSB0aGlzLl9vblRvdWNoU3RhcnQuYmluZCh0aGlzKTtcbiAgICAgICAgdGhpcy5fb25XaGVlbFNjcm9sbCA9IHRoaXMuX29uV2hlZWxTY3JvbGwuYmluZCh0aGlzKTtcblxuICAgICAgICB0aGlzLl9iaW5kRXZlbnRzKHRydWUpO1xuICAgICAgICB0aGlzLl9vblJlc2l6ZSgpO1xuXG4gICAgICAgICR3aW4ub24oJ3Jlc2l6ZSBvcmllbnRhdGlvbmNoYW5nZSBsb2FkJywgdGhpcy5fb25SZXNpemUpO1xuXG4gICAgICAgICRlbGVtLmRhdGEoJ3BhZ2VyJywgdGhpcyk7XG4gICAgfTtcblxuICAgIHZhciBwYWdlciA9IFBhZ2VyLnByb3RvdHlwZTtcblxuICAgIHBhZ2VyLnN0ZXAgPSBmdW5jdGlvbihkaWZmKSB7XG4gICAgICAgIHZhciBjdXJyZW50SXRlbSA9IHRoaXMuX2N1cnJlbnRJdGVtLFxuICAgICAgICAgICAgc3RlcHMgPSBjdXJyZW50SXRlbS5zdGVwcyxcbiAgICAgICAgICAgIG5leHRTdGVwLFxuICAgICAgICAgICAgc3RlcDtcblxuICAgICAgICBpZiAoc3RlcHMpIHtcbiAgICAgICAgICAgIHN0ZXAgPSBjdXJyZW50SXRlbS5zdGVwO1xuICAgICAgICAgICAgbmV4dFN0ZXAgPSBzdGVwICsgZGlmZjtcblxuICAgICAgICAgICAgaWYgKG5leHRTdGVwID49IDAgJiYgbmV4dFN0ZXAgPD0gKHN0ZXBzICsgKGlzVG91Y2ggPyAtMSA6IDApKSkge1xuICAgICAgICAgICAgICAgIGN1cnJlbnRJdGVtLnN0ZXAgPSBuZXh0U3RlcDtcblxuICAgICAgICAgICAgICAgIHRoaXMuXyRlbGVtLnRyaWdnZXIoJ2NoYW5nZV9zdGVwJywge1xuICAgICAgICAgICAgICAgICAgICBpdGVtOiBjdXJyZW50SXRlbSxcbiAgICAgICAgICAgICAgICAgICAgcHJldjogc3RlcCxcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudDogbmV4dFN0ZXAsXG4gICAgICAgICAgICAgICAgICAgIGlzTGFzdDogbmV4dFN0ZXAgPT09IHN0ZXBzLFxuICAgICAgICAgICAgICAgICAgICBpc0ZpcnN0OiBuZXh0U3RlcCA9PT0gMFxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IGRlbHRhXG4gICAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXVxuICAgICAqIEByZXR1cm5zIHtQYWdlcn1cbiAgICAgKi9cbiAgICBwYWdlci5tb3ZlID0gZnVuY3Rpb24oZGVsdGEsIG9wdGlvbnMpIHtcbiAgICAgICAgdmFyIG9wdHMgPSBvcHRpb25zIHx8IHt9LFxuICAgICAgICAgICAgaXRlbSxcbiAgICAgICAgICAgIGlzRG93bixcbiAgICAgICAgICAgIHBvc2l0aW9uLFxuICAgICAgICAgICAgaXNSZWFsU2Nyb2xsLFxuICAgICAgICAgICAgY3VycmVudEl0ZW0sXG4gICAgICAgICAgICBjdXJyZW50UG9zaXRpb247XG5cbiAgICAgICAgaWYgKHRoaXMuaXNEaXNhYmxlZCB8fCB0aGlzLnNjcm9sbGluZykge1xuICAgICAgICAgICAgdGhpcy5fbGFzdFNjcm9sbERlbHRhID0gZGVsdGE7XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGRlbHRhID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfVxuXG4gICAgICAgIGlzRG93biA9IGRlbHRhID4gMDtcbiAgICAgICAgaXNSZWFsU2Nyb2xsID0gISBvcHRzLmNoZWNrU2Nyb2xsIHx8IHRoaXMuX2lzUmVhbFNjcm9sbChkZWx0YSk7XG4gICAgICAgIGN1cnJlbnRJdGVtID0gdGhpcy5fY3VycmVudEl0ZW07XG4gICAgICAgIGN1cnJlbnRQb3NpdGlvbiA9IHRoaXMuX2N1cnJlbnRQb3NpdGlvbjtcblxuICAgICAgICBpZiAoXG4gICAgICAgICAgICBpc1JlYWxTY3JvbGwgJiZcbiAgICAgICAgICAgIG9wdHMuY2hlY2tTdGVwcyAmJlxuICAgICAgICAgICAgTWF0aC5hYnMoY3VycmVudFBvc2l0aW9uIC0gY3VycmVudEl0ZW0uc3RhcnQpIDwgNTBcbiAgICAgICAgKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5zdGVwKGlzRG93biA/IDEgOiAtMSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHBvc2l0aW9uID0gb3B0cy5wb3NpdGlvbjtcblxuICAgICAgICBpZiAodHlwZW9mIHBvc2l0aW9uICE9PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgcG9zaXRpb24gPSBjdXJyZW50UG9zaXRpb24gKyBkZWx0YTtcblxuICAgICAgICAgICAgaWYgKGRlbHRhID4gMCAmJiBjdXJyZW50UG9zaXRpb24gPCBjdXJyZW50SXRlbS53aW5IZWlnaHREaWZmKSB7XG4gICAgICAgICAgICAgICAgcG9zaXRpb24gPSBNYXRoLm1pbihwb3NpdGlvbiwgY3VycmVudEl0ZW0ud2luSGVpZ2h0RGlmZik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZGVsdGEgPCAwICYmIGN1cnJlbnRQb3NpdGlvbiA+IGN1cnJlbnRJdGVtLnN0YXJ0KSB7XG4gICAgICAgICAgICAgICAgcG9zaXRpb24gPSBNYXRoLm1heChwb3NpdGlvbiwgY3VycmVudEl0ZW0uc3RhcnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaXRlbSA9IHRoaXMuX2dldEl0ZW1CeVBvc2l0aW9uKHBvc2l0aW9uLCBpc0Rvd24gPyAnZG93bicgOiAndXAnLCBCb29sZWFuKG9wdHMucG9zaXRpb24pKTtcblxuICAgICAgICBpZiAoaXRlbSAhPT0gY3VycmVudEl0ZW0pIHtcbiAgICAgICAgICAgIGlmIChpc1JlYWxTY3JvbGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50UG9zaXRpb24gPSBpdGVtLnN0YXJ0O1xuXG4gICAgICAgICAgICAgICAgdGhpcy5nb1RvKGl0ZW0uaW5kZXgsIHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5fbGFzdFNjcm9sbERlbHRhID0gZGVsdGE7XG4gICAgICAgICAgICB0aGlzLl9jdXJyZW50UG9zaXRpb24gPSBNYXRoLm1heChpdGVtLnN0YXJ0LCBNYXRoLm1pbihwb3NpdGlvbiwgaXRlbS53aW5IZWlnaHREaWZmKSk7XG4gICAgICAgICAgICB0aGlzLl9jdXJyZW50SXRlbSA9IGl0ZW07XG5cbiAgICAgICAgICAgIHRoaXMubW92ZVRvKHtcbiAgICAgICAgICAgICAgICB0bzogdGhpcy5fY3VycmVudFBvc2l0aW9uLFxuICAgICAgICAgICAgICAgIGR1cmF0aW9uOiBvcHRzLnBvc2l0aW9uID8gMTAwIDogMFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQHJldHVybnMge1BhZ2VyfVxuICAgICAqL1xuICAgIHBhZ2VyLnByZXYgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5nb1RvKHRoaXMuX2N1cnJlbnRJdGVtID8gdGhpcy5fY3VycmVudEl0ZW0uaW5kZXggLSAxIDogMCk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEByZXR1cm5zIHtQYWdlcn1cbiAgICAgKi9cbiAgICBwYWdlci5uZXh0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuZ29Ubyh0aGlzLl9jdXJyZW50SXRlbSA/IHRoaXMuX2N1cnJlbnRJdGVtLmluZGV4ICsgMSA6IDApO1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBAcmV0dXJucyB7UGFnZXJ9XG4gICAgICovXG4gICAgcGFnZXIuZ29UbyA9IGZ1bmN0aW9uKGl0ZW1JbmRleCwgaXNGb3JjZSkge1xuICAgICAgICB2YXIgY3VycmVudEl0ZW0gPSB0aGlzLmdldEl0ZW0oaXRlbUluZGV4KTtcblxuICAgICAgICBpZiAoY3VycmVudEl0ZW0pIHtcbiAgICAgICAgICAgIHRoaXMuc2V0Q3VycmVudEl0ZW0oY3VycmVudEl0ZW0sIGlzRm9yY2UpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7alF1ZXJ5fSAkaXRlbXNcbiAgICAgKiBAcmV0dXJucyB7UGFnZXJ9XG4gICAgICovXG4gICAgcGFnZXIuYWRkSXRlbXMgPSBmdW5jdGlvbigkaXRlbXMpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcyxcbiAgICAgICAgICAgICRzbGlkZTtcblxuICAgICAgICAkLmVhY2goJGl0ZW1zLCBmdW5jdGlvbihpbmQsIHNsaWRlKSB7XG4gICAgICAgICAgICAkc2xpZGUgPSAkKHNsaWRlKTtcblxuICAgICAgICAgICAgX3RoaXMuX2l0ZW1zQ291bnQgPSBfdGhpcy5faXRlbXMucHVzaCh7XG4gICAgICAgICAgICAgICAgaW5kZXg6IGluZCxcbiAgICAgICAgICAgICAgICBzdGVwOiBwYXJzZUludCgkc2xpZGUuZGF0YSgnc3RlcCcpLCAxMCkgfHwgMCxcbiAgICAgICAgICAgICAgICBzdGVwczogcGFyc2VJbnQoJHNsaWRlLmRhdGEoJ3N0ZXBzJyksIDEwKSB8fCAwLFxuICAgICAgICAgICAgICAgICRlbGVtOiAkc2xpZGVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfFN0cmluZ30gW2l0ZW1JbmRleF1cbiAgICAgKiBAcmV0dXJucyB7P09iamVjdH1cbiAgICAgKi9cbiAgICBwYWdlci5nZXRJdGVtID0gZnVuY3Rpb24oaXRlbUluZGV4KSB7XG4gICAgICAgIHZhciBpbmRleCA9IGZhbHNlO1xuXG4gICAgICAgIGlmICh0eXBlb2YgaXRlbUluZGV4ID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgdGhpcy5faXRlbXMuc29tZShmdW5jdGlvbihzbGlkZSwgaW5kKSB7XG4gICAgICAgICAgICAgICAgaWYgKHNsaWRlLmlkID09PSBpdGVtSW5kZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgaW5kZXggPSBpbmQ7XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCQuaXNOdW1lcmljKGl0ZW1JbmRleCkpIHtcbiAgICAgICAgICAgIGluZGV4ID0gaXRlbUluZGV4ID4gLTEgJiYgaXRlbUluZGV4IDwgdGhpcy5faXRlbXNDb3VudCAmJiBpdGVtSW5kZXg7XG4gICAgICAgIH0gZWxzZSBpZiAoICEgaXRlbUluZGV4KSB7XG4gICAgICAgICAgICBpbmRleCA9IHRoaXMuX2N1cnJlbnRJdGVtICYmIHRoaXMuX2N1cnJlbnRJdGVtLmluZGV4O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuICQuaXNOdW1lcmljKGluZGV4KSA/XG4gICAgICAgICAgICB0aGlzLl9pdGVtc1tpbmRleF0gOlxuICAgICAgICAgICAgbnVsbDtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtkaXJlY3Rpb25dXG4gICAgICogQHJldHVybnMge1BhZ2VyfVxuICAgICAqL1xuICAgIHBhZ2VyLnVwZGF0ZVBvc2l0aW9uID0gZnVuY3Rpb24oZGlyZWN0aW9uKSB7XG4gICAgICAgIHZhciBpdGVtID0gdGhpcy5fZ2V0SXRlbUJ5UG9zaXRpb24odGhpcy5fY3VycmVudFBvc2l0aW9uLCBkaXJlY3Rpb24pO1xuXG4gICAgICAgIGlmIChpdGVtICE9PSB0aGlzLl9jdXJyZW50SXRlbSkge1xuICAgICAgICAgICAgdGhpcy5nb1RvKGl0ZW0uaW5kZXgsIHRydWUpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjdXJyZW50SXRlbVxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW2lzRm9yY2VdXG4gICAgICogQHJldHVybnMge1BhZ2VyfVxuICAgICAqL1xuICAgIHBhZ2VyLnNldEN1cnJlbnRJdGVtID0gZnVuY3Rpb24oY3VycmVudEl0ZW0sIGlzRm9yY2UpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcyxcbiAgICAgICAgICAgIHByZXZJdGVtID0gX3RoaXMuX2N1cnJlbnRJdGVtLFxuICAgICAgICAgICAgaXNDdXJyZW50ID0gY3VycmVudEl0ZW0gPT09IHByZXZJdGVtO1xuXG4gICAgICAgIGlmICggISBpc0ZvcmNlICYmIGlzQ3VycmVudCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoICEgaXNDdXJyZW50KSB7XG4gICAgICAgICAgICAvLyBwcmV2SXRlbSAmJiBwcmV2SXRlbS4kZWxlbS5yZW1vdmVDbGFzcygnY3VycmVudCcpO1xuXG4gICAgICAgICAgICBfdGhpcy5fJGVsZW0udHJpZ2dlcignY2hhbmdlX3N0YXJ0Jywge1xuICAgICAgICAgICAgICAgIG5leHQ6IGN1cnJlbnRJdGVtLFxuICAgICAgICAgICAgICAgIGN1cnJlbnQ6IHByZXZJdGVtXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIF90aGlzXG4gICAgICAgICAgICAubW92ZVRvKHsgdG86IGN1cnJlbnRJdGVtLnN0YXJ0IH0pXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBpZiAoICEgaXNDdXJyZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGN1cnJlbnRJdGVtLiRlbGVtLmFkZENsYXNzKCdjdXJyZW50Jyk7XG5cbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuX2N1cnJlbnRJdGVtID0gY3VycmVudEl0ZW07XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLl8kZWxlbVxuICAgICAgICAgICAgICAgICAgICAgICAgLnRyaWdnZXIoJ2NoYW5nZV9kb25lJywge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByZXY6IHByZXZJdGVtLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnQ6IGN1cnJlbnRJdGVtXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IG9wdHNcbiAgICAgKiBAcmV0dXJuIHs/alF1ZXJ5LkRlZmVycmVkfVxuICAgICAqL1xuICAgIHBhZ2VyLm1vdmVUbyA9IGZ1bmN0aW9uKG9wdHMpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcblxuICAgICAgICBpZiAoX3RoaXMuc2Nyb2xsaW5nKSB7XG4gICAgICAgICAgICBfdGhpcy5zY3JvbGxpbmcucmVqZWN0KCk7XG4gICAgICAgIH1cblxuICAgICAgICBfdGhpcy5zY3JvbGxpbmcgPSBzY3JvbGwoX3RoaXMuXyRlbGVtLCBvcHRzKTtcblxuICAgICAgICBfdGhpcy5zY3JvbGxpbmdcbiAgICAgICAgICAgIC5hbHdheXMoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuc2Nyb2xsaW5nID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9LCAwKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiBfdGhpcy5zY3JvbGxpbmc7XG4gICAgfTtcblxuICAgIHBhZ2VyLmRpc2FibGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5pc0Rpc2FibGVkID0gdHJ1ZTtcbiAgICB9O1xuXG4gICAgcGFnZXIuZW5hYmxlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuaXNEaXNhYmxlZCA9IGZhbHNlO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbcG9zaXRpb25dINCf0L7Qt9C40YbQuNGPXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtkaXJlY3Rpb25dINCd0LDQv9GA0LDQstC70LXQvdC40LVcbiAgICAgKiBAcmV0dXJucyB7P09iamVjdH0g0JDQudGC0LXQvCwg0YHQvtC+0YLQstC10YLRgdGC0LLRg9GO0YnQuNC5INC/0L7Qt9C40YbQuNC4XG4gICAgICovXG4gICAgcGFnZXIuX2dldEl0ZW1CeVBvc2l0aW9uID0gZnVuY3Rpb24ocG9zaXRpb24sIGRpcmVjdGlvbiwgd2l0aEJvdW5jZSkge1xuICAgICAgICB2YXIgc3RhcnQgPSBwb3NpdGlvbiB8fCB0aGlzLl9jdXJyZW50UG9zaXRpb24sXG4gICAgICAgICAgICBlbmQgPSBzdGFydCArIHRoaXMud2luU2l6ZS5oZWlnaHQsXG4gICAgICAgICAgICBpdGVtcyA9IHRoaXMuX2l0ZW1zLFxuICAgICAgICAgICAgaXRlbXNMZW4gPSB0aGlzLl9pdGVtc0NvdW50LFxuICAgICAgICAgICAgY2hlY2tpbmdJbmRleCA9IDAsXG4gICAgICAgICAgICBvZmZzZXQsXG4gICAgICAgICAgICBpdGVtO1xuXG4gICAgICAgIHdoaWxlICgoaXRlbSA9IGl0ZW1zW2NoZWNraW5nSW5kZXgrK10pKSB7XG4gICAgICAgICAgICBvZmZzZXQgPSBzdGFydCAtIGl0ZW0uc3RhcnQ7XG5cbiAgICAgICAgICAgIGlmICggISBkaXJlY3Rpb24pIHtcbiAgICAgICAgICAgICAgICBpZiAoaXRlbS5oYWxmSGVpZ2h0ID49IG9mZnNldCkge1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICAgICAgZGlyZWN0aW9uID09PSAnZG93bicgJiZcbiAgICAgICAgICAgICAgICAgICAgaXRlbVt3aXRoQm91bmNlID8gJ3FTdGFydCcgOiAnc3RhcnQnXSA8PSBlbmQgJiZcbiAgICAgICAgICAgICAgICAgICAgaXRlbVt3aXRoQm91bmNlID8gJ3FFbmQnIDogJ2VuZCddID49IGVuZFxuICAgICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoZGlyZWN0aW9uID09PSAndXAnICYmIGl0ZW1bd2l0aEJvdW5jZSA/ICdxc0VuZCcgOiAnZW5kJ10gPiBzdGFydCkge1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoICEgaXRlbSkge1xuICAgICAgICAgICAgaXRlbSA9IGRpcmVjdGlvbiA9PT0gJ2Rvd24nID8gaXRlbXNbaXRlbXNMZW4gLSAxXSA6IGl0ZW1zWzBdO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGl0ZW07XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBpc09uXG4gICAgICovXG4gICAgcGFnZXIuX2JpbmRFdmVudHMgPSBmdW5jdGlvbihpc09uKSB7XG4gICAgICAgICQoJy5wYWdlcl9fbmF2X2Rpcl9uZXh0JylbaXNPbiA/ICdvbicgOiAnb2ZmJ10oaXNUb3VjaCA/ICd0YXAnIDogJ2NsaWNrJywgdGhpcy5uZXh0LmJpbmQodGhpcykpO1xuXG4gICAgICAgIHRoaXMuXyRlbGVtW2lzT24gPyAnb24nIDogJ29mZiddKGlzVG91Y2ggP1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHRvdWNoZW5kOiB0aGlzLl9vblRvdWNoRW5kLFxuICAgICAgICAgICAgICAgIHRvdWNoc3RhcnQ6IHRoaXMuX29uVG91Y2hTdGFydFxuICAgICAgICAgICAgfSA6XG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgd2hlZWw6IHRoaXMuX29uV2hlZWxTY3JvbGwsXG4gICAgICAgICAgICAgICAgc2Nyb2xsOiB0aGlzLl9vblNjcm9sbFxuICAgICAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IG5ld0RlbHRhXG4gICAgICogQHJldHVybnMge0Jib29sZWFufVxuICAgICAqL1xuICAgIHBhZ2VyLl9pc1JlYWxTY3JvbGwgPSBmdW5jdGlvbihuZXdEZWx0YSkge1xuICAgICAgICB2YXIgb2xkRGVsdGEgPSB0aGlzLl9sYXN0U2Nyb2xsRGVsdGEsXG4gICAgICAgICAgICBpc1JlYWxTY3JvbGwgPSBmYWxzZTtcblxuICAgICAgICBpZiAobmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCdNYWMnKSA9PT0gLTEpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG9sZERlbHRhICE9PSBudWxsKSB7XG4gICAgICAgICAgICAvLyBkaWZmZXJlbnQgZGlyZWN0aW9uXG4gICAgICAgICAgICBpZiAob2xkRGVsdGEgPCAwICYmIG5ld0RlbHRhID4gMCkge1xuICAgICAgICAgICAgICAgIGlzUmVhbFNjcm9sbCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAob2xkRGVsdGEgPiAwICYmIG5ld0RlbHRhIDwgMCkge1xuICAgICAgICAgICAgICAgIGlzUmVhbFNjcm9sbCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBzYW1lIGRpcmVjdGlvblxuICAgICAgICAgICAgaWYgKG9sZERlbHRhID4gMCAmJiBuZXdEZWx0YSA+IDApIHtcbiAgICAgICAgICAgICAgICBpc1JlYWxTY3JvbGwgPSBvbGREZWx0YSA8IG5ld0RlbHRhO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG9sZERlbHRhIDwgMCAmJiBuZXdEZWx0YSA8IDApIHtcbiAgICAgICAgICAgICAgICBpc1JlYWxTY3JvbGwgPSBvbGREZWx0YSA+IG5ld0RlbHRhO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaXNSZWFsU2Nyb2xsID0gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuX2xhc3RTY3JvbGxEZWx0YSA9IG5ld0RlbHRhO1xuXG4gICAgICAgIHJldHVybiBpc1JlYWxTY3JvbGw7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtqUXVlcnkuRXZlbnR9IGV2ZW50XG4gICAgICovXG4gICAgcGFnZXIuX29uV2hlZWxTY3JvbGwgPSBmdW5jdGlvbihldmVudCkge1xuICAgICAgICB2YXIgZSA9IGV2ZW50Lm9yaWdpbmFsRXZlbnQgfHwgd2luZG93LmV2ZW50O1xuXG4gICAgICAgIGlmIChNYXRoLmFicyhlLmRlbHRhWSkgPCBNYXRoLmFicyhlLmRlbHRhWCkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMubW92ZShlLmRlbHRhWSwge1xuICAgICAgICAgICAgY2hlY2tTY3JvbGw6IHRydWUsXG4gICAgICAgICAgICBjaGVja1N0ZXBzOiB0cnVlXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge2pRdWVyeS5FdmVudH0gZXZlbnRcbiAgICAgKi9cbiAgICBwYWdlci5fb25Ub3VjaFN0YXJ0ID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgdmFyIHRvdWNoZXMsXG4gICAgICAgICAgICB0b3VjaCA9IHRydWU7XG5cbiAgICAgICAgaWYgKGV2ZW50LmlzRGVmYXVsdFByZXZlbnRlZCgpKSB7XG4gICAgICAgICAgICB0b3VjaCA9IG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICB0b3VjaGVzID0gdG91Y2ggJiYgZXZlbnQub3JpZ2luYWxFdmVudC50YXJnZXRUb3VjaGVzO1xuXG4gICAgICAgIC8vINC40LPQvdC+0YDQuNC8INC10YHQu9C4INC90LAg0Y3QutGA0LDQvdC1INGB0LvQuNGI0LrQvtC8INC80L3QvtCz0L4g0L/QsNC70YzRhtC10LJcbiAgICAgICAgaWYgKHRvdWNoZXMgJiYgdG91Y2hlcy5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICB0b3VjaCA9IG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLl90b3VjaFN0YXJ0ID0gdG91Y2ggJiYgKHRvdWNoZXMgPyB0b3VjaGVzWzBdIDogZXZlbnQub3JpZ2luYWxFdmVudCk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtqUXVlcnkuRXZlbnR9IGV2ZW50XG4gICAgICovXG4gICAgcGFnZXIuX29uVG91Y2hFbmQgPSBmdW5jdGlvbihldmVudCkge1xuICAgICAgICBpZiAodGhpcy5fdG91Y2hTdGFydCA9PT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIHRvdWNoZXMgPSBldmVudC5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzLFxuICAgICAgICAgICAgY3VycmVudFRvdWNoID0gdG91Y2hlcyA/IHRvdWNoZXNbMF0gOiBldmVudC5vcmlnaW5hbEV2ZW50O1xuXG4gICAgICAgIHRoaXMubW92ZSh0aGlzLl90b3VjaFN0YXJ0LnBhZ2VZIC0gY3VycmVudFRvdWNoLnBhZ2VZLCB7XG4gICAgICAgICAgICBwb3NpdGlvbjogdGhpcy5fJGVsZW0uc2Nyb2xsVG9wKClcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIHBhZ2VyLl9vblNjcm9sbCA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgIHRoaXMuc2Nyb2xsaW5nIHx8IHRoaXMubW92ZSh0aGlzLl8kZWxlbS5zY3JvbGxUb3AoKSAtIHRoaXMuX2N1cnJlbnRQb3NpdGlvbik7XG5cbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIHBhZ2VyLl9vblJlc2l6ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgd2luSGVpZ2h0ID0gJHdpbi5oZWlnaHQoKSxcbiAgICAgICAgICAgIGxhc3RFbmQgPSAwO1xuXG4gICAgICAgIHRoaXMuX2l0ZW1zLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgaXRlbS5oZWlnaHQgPSBpdGVtLiRlbGVtLm91dGVySGVpZ2h0KCk7XG4gICAgICAgICAgICBpdGVtLmhhbGZIZWlnaHQgPSBpdGVtLmhlaWdodCAvIDI7XG4gICAgICAgICAgICBpdGVtLnN0YXJ0ID0gbGFzdEVuZDtcbiAgICAgICAgICAgIGl0ZW0uZW5kID0gKGxhc3RFbmQgKz0gaXRlbS5oZWlnaHQpO1xuICAgICAgICAgICAgaXRlbS5xU3RhcnQgPSBpdGVtLnN0YXJ0ICsgaXRlbS5oZWlnaHQgLyAxMDtcbiAgICAgICAgICAgIGl0ZW0ucUVuZCA9IGl0ZW0uZW5kICsgaXRlbS5oZWlnaHQgLyAxMDtcbiAgICAgICAgICAgIGl0ZW0ucXNFbmQgPSBpdGVtLmVuZCAtIGl0ZW0uaGVpZ2h0IC8gMTA7XG4gICAgICAgICAgICBpdGVtLndpbkhlaWdodERpZmYgPSBpdGVtLmVuZCAtIHdpbkhlaWdodDtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy53aW5TaXplIHx8ICh0aGlzLndpblNpemUgPSB7fSk7XG4gICAgICAgIHRoaXMud2luU2l6ZS5oZWlnaHQgPSB3aW5IZWlnaHQ7XG5cbiAgICAgICAgdGhpcy5fY3VycmVudFBvc2l0aW9uID0gdGhpcy5fJGVsZW0uc2Nyb2xsVG9wKCk7XG5cbiAgICAgICAgdGhpcy51cGRhdGVQb3NpdGlvbigpO1xuICAgIH07XG5cbiAgICAkLmZuLnBhZ2VyID0gZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgICB0aGlzLmVhY2goZnVuY3Rpb24oaW5kLCBlbGVtKSB7XG4gICAgICAgICAgICAvKiBqc2hpbnQgLVcwMzEgKi9cbiAgICAgICAgICAgIG5ldyBQYWdlcihlbGVtLCBvcHRpb25zKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxufSkoZG9jdW1lbnQsIHdpbmRvdywgalF1ZXJ5KTtcbiIsIm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oJGVsZW0sIG9wdGlvbnMpIHtcbiAgICB2YXIgb3B0cyA9IG9wdGlvbnMgfHwge30sXG4gICAgICAgIHRvID0gcGFyc2VJbnQob3B0aW9ucy50bywgMTApLFxuICAgICAgICBkdXJhdGlvbiA9IHBhcnNlSW50KG9wdHMuZHVyYXRpb24sIDEwKSxcbiAgICAgICAgZGVmZiA9ICQuRGVmZXJyZWQoKSxcbiAgICAgICAgZWFzaW5nO1xuXG4gICAgaWYgKGlzTmFOKGR1cmF0aW9uKSkge1xuICAgICAgICBkdXJhdGlvbiA9IE1hdGguc3FydChNYXRoLmFicygkZWxlbS5zY3JvbGxUb3AoKSAtIHRvKSkgKiA0MDtcbiAgICB9XG5cbiAgICBpZiAoZHVyYXRpb24gPiAwKSB7XG4gICAgICAgIGVhc2luZyA9IG9wdHMuZWFzaW5nO1xuXG4gICAgICAgIGlmICh0eXBlb2YgZWFzaW5nICE9PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgZWFzaW5nID0gJ2Vhc2VPdXRDdWJpYyc7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiAkLmVhc2luZ1tlYXNpbmddICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICBlYXNpbmcgPSAnbGluZWFyJztcbiAgICAgICAgfVxuICAgIH1cblxuICAgICRlbGVtXG4gICAgICAgIC5zdG9wKClcbiAgICAgICAgLmFuaW1hdGUoXG4gICAgICAgICAgICB7IHNjcm9sbFRvcDogdG8gfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBkdXJhdGlvbjogZHVyYXRpb24sXG4gICAgICAgICAgICAgICAgZWFzaW5nOiBlYXNpbmcsXG4gICAgICAgICAgICAgICAgcXVldWU6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGRvbmU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBkZWZmLnJlc29sdmUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgIHJldHVybiBkZWZmO1xufTtcbiJdfQ=="}