{"version":3,"sources":["js/node_modules/browser-pack/_prelude.js","js/src/js/entry.js","js/src/js/lib/debounce.js","js/src/js/lib/pager.js","js/src/js/lib/scroll.js"],"names":[],"mappings":"AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACtCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACxBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChfA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"bundle.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","require('./lib/pager');\n\n$(function() {\n    var $pager = $('.pager'),\n        $video = $('.pager__page').eq(0),\n        $screens = $('.screens'),\n        $screensImages = $('.screens__images'),\n        video = $video.data('vide').getVideoObject(),\n        pager;\n\n    $pager.pager();\n    pager = $pager.data('pager');\n\n    $pager\n        .on('change_start', function() {\n            video.pause();\n        })\n        .on('change_done', function(e, data) {\n            if (data.current.$elem.is($video)) {\n                video.play();\n            }\n        })\n        .on('change_step', function(e, data) {\n            pager.disable();\n\n            $screens\n                .removeClass('screens_step_' + data.prev)\n                .addClass('screens_step_' + data.current);\n\n            $screensImages\n                .css('transform', 'translate3d(0, ' + data.current * -10 + '%, 0)');\n\n            setTimeout(function() {\n                pager.enable();\n            }, data.isFirst || data.isLast ? 1100 : 900);\n        });\n\n});\n","module.exports = function(fn, timeout, invokeAsap, ctx) {\n    if(arguments.length == 3 && typeof invokeAsap != 'boolean') {\n        ctx = invokeAsap;\n        invokeAsap = false;\n    }\n\n    var timer;\n\n    return function() {\n\n        var args = arguments;\n        ctx = ctx || this;\n\n        invokeAsap && !timer && fn.apply(ctx, args);\n\n        clearTimeout(timer);\n\n        timer = setTimeout(function() {\n            invokeAsap || fn.apply(ctx, args);\n            timer = null;\n        }, timeout);\n\n    };\n};\n","var debounce = require('./debounce'),\n    scroll = require('./scroll');\n\n(function(doc, win, $, undefined) {\n    var $win = $(win);\n\n    var Pager = function(elem) {\n        var $elem = $(elem),\n            $movable = $elem.find('.pager__movable');\n\n        if ($movable.length === 0) {\n            $movable = $elem;\n        }\n\n        this._$elem = $elem;\n        this._items = [];\n        this._itemsCount = 0;\n        this._currentItem = null;\n\n        this.addItems($movable.children('article'));\n\n        this._onResize = debounce(this._onResize, 100, this);\n        this._onScroll = debounce(this._onScroll, 500, this);\n        this._onTouchEnd = this._onTouchEnd.bind(this);\n        this._onTouchStart = this._onTouchStart.bind(this);\n        this._onWheelScroll = this._onWheelScroll.bind(this);\n\n        this._bindEvents(true);\n        this._onResize();\n\n        $win.on('resize', this._onResize);\n\n        $elem.data('pager', this);\n    };\n\n    var pager = Pager.prototype;\n\n    pager.stepMove = function(delta, options) {\n        var opts = options || {},\n            currentItem,\n            step,\n            steps,\n            nextStep;\n\n        currentItem = this._currentItem;\n\n        if (this._currentPosition === currentItem.start) {\n            steps = currentItem.steps;\n        }\n\n        if (steps) {\n            step = currentItem.step;\n            nextStep = step + (delta > 0 ? 1 : -1);\n        }\n\n        if (nextStep >= 0 && nextStep < steps) {\n            if ( ! opts.checkScroll || this._isRealScroll(delta)) {\n                currentItem.step = nextStep;\n\n                this._$elem.trigger('change_step', {\n                    item: currentItem,\n                    prev: step,\n                    current: nextStep,\n                    isLast: nextStep === steps - 1,\n                    isFirst: nextStep === 0\n                });\n            }\n\n            return this;\n        }\n    };\n\n    /**\n     * @param {Number} delta\n     * @param {Object} [options]\n     * @returns {Pager}\n     */\n    pager.move = function(delta, options) {\n        var opts = options || {},\n            item,\n            step,\n            steps,\n            position,\n            nextStep,\n            currentItem;\n\n        if (this.isDisabled || this.scrolling) {\n            this._lastScrollDelta = delta;\n\n            return this;\n        }\n\n        if (delta === 0) {\n            return this;\n        }\n\n        currentItem = this._currentItem;\n\n        if (opts.checkSteps && this._currentPosition === currentItem.start) {\n            steps = currentItem.steps;\n        }\n\n        if (steps) {\n            step = currentItem.step;\n            nextStep = step + (delta > 0 ? 1 : -1);\n        }\n\n        if (nextStep >= 0 && nextStep <= steps - 1) {\n            if ( ! opts.checkScroll || this._isRealScroll(delta)) {\n                currentItem.step = nextStep;\n\n                this._$elem.trigger('change_step', {\n                    item: currentItem,\n                    prev: step,\n                    current: nextStep,\n                    isLast: nextStep === steps - 1,\n                    isFirst: nextStep === 0\n                });\n            }\n\n            return this;\n        }\n\n        position = this._currentPosition + delta;\n\n        if (delta > 0 && this._currentPosition < (currentItem.end - this.winSize.height)) {\n            position = Math.min(position, currentItem.end - this.winSize.height);\n        }\n        if (delta < 0 && this._currentPosition > currentItem.start) {\n            position = Math.max(position, currentItem.start);\n        }\n\n        item = this._getItemByPosition(position, delta > 0 ? 'down' : 'up');\n\n        if (item !== currentItem) {\n            if ( ! opts.checkScroll || this._isRealScroll(delta)) {\n                this._currentPosition = item.start;\n\n                this.goTo(item.index, true);\n            }\n        } else {\n            this._lastScrollDelta = delta;\n            this._currentPosition = Math.max(item.start, Math.min(position, item.end - this.winSize.height));\n            this._currentItem = item;\n            this.moveTo({\n                to: this._currentPosition,\n                duration: 0\n            });\n        }\n\n        return this;\n    };\n\n    /**\n     * @returns {Pager}\n     */\n    pager.prev = function() {\n        this.goTo(this._currentItem ? this._currentItem.index - 1 : 0);\n\n        return this;\n    };\n\n    /**\n     * @returns {Pager}\n     */\n    pager.next = function() {\n        this.goTo(this._currentItem ? this._currentItem.index + 1 : 0);\n\n        return this;\n    };\n\n    /**\n     * @returns {Pager}\n     */\n    pager.goTo = function(itemIndex, isForce) {\n        var currentItem = this.getItem(itemIndex);\n\n        if (currentItem) {\n            this.setCurrentItem(currentItem, isForce);\n        }\n\n        return this;\n    };\n\n    /**\n     * @param {jQuery} $items\n     * @returns {Pager}\n     */\n    pager.addItems = function($items) {\n        var _this = this,\n            id = _this.id,\n            $slide,\n            slideId;\n\n        $.each($items, function(ind, slide) {\n            $slide = $(slide);\n            slideId = $slide.attr('id') || ('slide' + ind + 1);\n            $slide.attr('id', id + '_' + slideId);\n\n            _this._itemsCount = _this._items.push({\n                id: slideId,\n                index: ind,\n                step: parseInt($slide.data('step'), 10) || 0,\n                steps: parseInt($slide.data('steps'), 10) || 0,\n                $elem: $slide\n            });\n        });\n\n        return _this;\n    };\n\n    /**\n     * @param {Number|String} [itemIndex]\n     * @returns {?Object}\n     */\n    pager.getItem = function(itemIndex) {\n        var index = false;\n\n        if (typeof itemIndex === 'string') {\n            this._items.some(function(slide, ind) {\n                if (slide.id === itemIndex) {\n                    index = ind;\n\n                    return false;\n                }\n            });\n        }\n\n        if ($.isNumeric(itemIndex)) {\n            index = itemIndex > -1 && itemIndex < this._itemsCount && itemIndex;\n        } else if ( ! itemIndex) {\n            index = this._currentItem && this._currentItem.index;\n        }\n\n        return $.isNumeric(index) ?\n            this._items[index] :\n            null;\n    };\n\n    /**\n     * @param {String} [direction]\n     * @returns {Pager}\n     */\n    pager.updatePosition = function(direction) {\n        var item = this._getItemByPosition(this._currentPosition, direction);\n\n        if (item !== this._currentItem) {\n            this.goTo(item.index, true);\n        }\n\n        return this;\n    };\n\n    /**\n     * @param {Object} currentItem\n     * @param {Boolean} [isForce]\n     * @returns {Pager}\n     */\n    pager.setCurrentItem = function(currentItem, isForce) {\n        var _this = this,\n            prevItem = _this._currentItem,\n            isCurrent = currentItem === prevItem;\n\n        if ( ! isForce && isCurrent) {\n            return this;\n        }\n\n        if ( ! isCurrent) {\n            prevItem && prevItem.$elem.removeClass('current');\n\n            _this._$elem.trigger('change_start', {\n                next: currentItem,\n                current: prevItem\n            });\n        }\n\n        _this\n            .moveTo({ to: currentItem.start })\n            .then(function() {\n                if ( ! isCurrent) {\n                    currentItem.$elem.addClass('current');\n\n                    _this._currentItem = currentItem;\n                    _this._$elem\n                        .trigger('change_done', {\n                            prev: prevItem,\n                            current: currentItem\n                        });\n                }\n            });\n\n        return this;\n    };\n\n    /**\n     * @param {Object} opts\n     * @return {?jQuery.Deferred}\n     */\n    pager.moveTo = function(opts) {\n        var _this = this;\n\n        if (_this.scrolling) {\n            _this.scrolling.reject();\n        }\n\n        _this.scrolling = scroll(_this._$elem, opts);\n\n        _this.scrolling\n            .always(function() {\n                setTimeout(function() {\n                    _this.scrolling = null;\n                }, 0);\n            });\n\n        return _this.scrolling;\n    };\n\n    pager.disable = function() {\n        this.isDisabled = true;\n    };\n\n    pager.enable = function() {\n        this.isDisabled = false;\n    };\n\n    /**\n     * @private\n     * @param {Number} [position] Позиция\n     * @param {String} [direction] Направление\n     * @returns {?Object} Айтем, соответствующий позиции\n     */\n    pager._getItemByPosition = function(position, direction) {\n        var start = position || this._currentPosition,\n            end = start + this.winSize.height,\n            items = this._items,\n            itemsLen = this._itemsCount,\n            checkingIndex = 0,\n            offset,\n            item;\n\n        while ((item = items[checkingIndex++])) {\n            offset = start - item.start;\n\n            if ( ! direction) {\n                if (item.height / 2 >= offset) {\n                    break;\n                }\n            } else {\n                if (direction === 'down' && item.start <= end && item.end >= end) {\n                    break;\n                }\n\n                if (direction === 'up' && item.end > start) {\n                    break;\n                }\n            }\n        }\n\n        if ( ! item) {\n            item = direction === 'down' ? items[itemsLen - 1] : items[0];\n        }\n\n        return item;\n    };\n\n    /**\n     * @private\n     * @param {Boolean} isOn\n     */\n    pager._bindEvents = function(isOn) {\n        this._$elem[isOn ? 'on' : 'off']('ontouchstart' in doc.documentElement ?\n            {\n                touchend: this._onTouchEnd,\n                touchstart: this._onTouchStart\n            } :\n            {\n                wheel: this._onWheelScroll,\n                scroll: this._onScroll\n            });\n\n        $('.pager__nav_dir_next').click(this.next.bind(this));\n        $('.pager__nav_dir_prev').click(this.prev.bind(this));\n    };\n\n    /**\n     * @private\n     * @param {Number} newDelta\n     * @returns {Bboolean}\n     */\n    pager._isRealScroll = function(newDelta) {\n        var oldDelta = this._lastScrollDelta,\n            isRealScroll = false;\n\n        if (oldDelta !== null) {\n            // different direction\n            if (oldDelta < 0 && newDelta > 0) {\n                isRealScroll = true;\n            }\n            if (oldDelta > 0 && newDelta < 0) {\n                isRealScroll = true;\n            }\n            // same direction\n            if (oldDelta > 0 && newDelta > 0) {\n                isRealScroll = oldDelta < newDelta;\n            }\n            if (oldDelta < 0 && newDelta < 0) {\n                isRealScroll = oldDelta > newDelta;\n            }\n        } else {\n            isRealScroll = true;\n        }\n\n        this._lastScrollDelta = newDelta;\n\n        return isRealScroll;\n    };\n\n    /**\n     * @private\n     * @param {jQuery.Event} event\n     */\n    pager._onWheelScroll = function(event) {\n        var e = event.originalEvent || window.event;\n\n        if (Math.abs(e.deltaY) < Math.abs(e.deltaX)) {\n            return;\n        }\n\n        this.move(e.deltaY, {\n            checkScroll: true,\n            checkSteps: true\n        });\n\n        event.preventDefault();\n        event.stopPropagation();\n\n        return false;\n    };\n\n    /**\n     * @private\n     * @param {jQuery.Event} event\n     */\n    pager._onTouchStart = function(event) {\n        this._touchStartY = event.originalEvent.touches[0].pageY;\n    };\n\n    /**\n     * @private\n     * @param {jQuery.Event} event\n     */\n    pager._onTouchEnd = function(event) {\n        this.move(this._touchStartY - event.originalEvent.changedTouches[0].pageY);\n\n        event.preventDefault();\n        event.stopPropafation();\n\n        return false;\n    };\n\n    /**\n     * @private\n     */\n    pager._onScroll = function() {\n        this.move(this._$elem.scrollTop() - this._currentPosition);\n    };\n\n    /**\n     * @private\n     */\n    pager._onResize = function() {\n        var winHeight = $win.height(),\n            lastEnd = 0;\n\n        this._items.forEach(function(slide) {\n            slide.height = slide.$elem.outerHeight();\n            slide.start = lastEnd;\n            slide.end = (lastEnd += slide.height);\n        });\n\n        this.winSize || (this.winSize = {});\n        this.winSize.height = winHeight;\n\n        this._currentPosition = this._$elem.scrollTop();\n\n        this.updatePosition();\n    };\n\n    $.fn.pager = function(options) {\n        this.each(function(ind, elem) {\n            /* jshint -W031 */\n            new Pager(elem, options);\n        });\n    };\n\n})(document, window, jQuery);\n","module.exports = function($elem, options) {\n    var opts = options || {},\n        to = parseInt(options.to, 10),\n        duration = parseInt(opts.duration, 10),\n        deff = $.Deferred(),\n        easing;\n\n    if (isNaN(duration)) {\n        duration = Math.sqrt(Math.abs($elem.scrollTop() - to)) * 40;\n    }\n\n    if (duration > 0) {\n        easing = opts.easing;\n\n        if (typeof easing !== 'string') {\n            easing = 'easeOutCubic';\n        }\n        if (typeof $.easing[easing] !== 'function') {\n            easing = 'linear';\n        }\n    }\n\n    $elem\n        .stop()\n        .animate(\n            { scrollTop: to },\n            {\n                duration: duration,\n                easing: easing,\n                queue: false,\n                done: function() {\n                    deff.resolve();\n                }\n            });\n\n    return deff;\n};\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvanMvZW50cnkuanMiLCJzcmMvanMvbGliL2RlYm91bmNlLmpzIiwic3JjL2pzL2xpYi9wYWdlci5qcyIsInNyYy9qcy9saWIvc2Nyb2xsLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3RDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN4QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoZkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJyZXF1aXJlKCcuL2xpYi9wYWdlcicpO1xuXG4kKGZ1bmN0aW9uKCkge1xuICAgIHZhciAkcGFnZXIgPSAkKCcucGFnZXInKSxcbiAgICAgICAgJHZpZGVvID0gJCgnLnBhZ2VyX19wYWdlJykuZXEoMCksXG4gICAgICAgICRzY3JlZW5zID0gJCgnLnNjcmVlbnMnKSxcbiAgICAgICAgJHNjcmVlbnNJbWFnZXMgPSAkKCcuc2NyZWVuc19faW1hZ2VzJyksXG4gICAgICAgIHZpZGVvID0gJHZpZGVvLmRhdGEoJ3ZpZGUnKS5nZXRWaWRlb09iamVjdCgpLFxuICAgICAgICBwYWdlcjtcblxuICAgICRwYWdlci5wYWdlcigpO1xuICAgIHBhZ2VyID0gJHBhZ2VyLmRhdGEoJ3BhZ2VyJyk7XG5cbiAgICAkcGFnZXJcbiAgICAgICAgLm9uKCdjaGFuZ2Vfc3RhcnQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZpZGVvLnBhdXNlKCk7XG4gICAgICAgIH0pXG4gICAgICAgIC5vbignY2hhbmdlX2RvbmUnLCBmdW5jdGlvbihlLCBkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YS5jdXJyZW50LiRlbGVtLmlzKCR2aWRlbykpIHtcbiAgICAgICAgICAgICAgICB2aWRlby5wbGF5KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICAgIC5vbignY2hhbmdlX3N0ZXAnLCBmdW5jdGlvbihlLCBkYXRhKSB7XG4gICAgICAgICAgICBwYWdlci5kaXNhYmxlKCk7XG5cbiAgICAgICAgICAgICRzY3JlZW5zXG4gICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKCdzY3JlZW5zX3N0ZXBfJyArIGRhdGEucHJldilcbiAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoJ3NjcmVlbnNfc3RlcF8nICsgZGF0YS5jdXJyZW50KTtcblxuICAgICAgICAgICAgJHNjcmVlbnNJbWFnZXNcbiAgICAgICAgICAgICAgICAuY3NzKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlM2QoMCwgJyArIGRhdGEuY3VycmVudCAqIC0xMCArICclLCAwKScpO1xuXG4gICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHBhZ2VyLmVuYWJsZSgpO1xuICAgICAgICAgICAgfSwgZGF0YS5pc0ZpcnN0IHx8IGRhdGEuaXNMYXN0ID8gMTEwMCA6IDkwMCk7XG4gICAgICAgIH0pO1xuXG59KTtcbiIsIm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oZm4sIHRpbWVvdXQsIGludm9rZUFzYXAsIGN0eCkge1xuICAgIGlmKGFyZ3VtZW50cy5sZW5ndGggPT0gMyAmJiB0eXBlb2YgaW52b2tlQXNhcCAhPSAnYm9vbGVhbicpIHtcbiAgICAgICAgY3R4ID0gaW52b2tlQXNhcDtcbiAgICAgICAgaW52b2tlQXNhcCA9IGZhbHNlO1xuICAgIH1cblxuICAgIHZhciB0aW1lcjtcblxuICAgIHJldHVybiBmdW5jdGlvbigpIHtcblxuICAgICAgICB2YXIgYXJncyA9IGFyZ3VtZW50cztcbiAgICAgICAgY3R4ID0gY3R4IHx8IHRoaXM7XG5cbiAgICAgICAgaW52b2tlQXNhcCAmJiAhdGltZXIgJiYgZm4uYXBwbHkoY3R4LCBhcmdzKTtcblxuICAgICAgICBjbGVhclRpbWVvdXQodGltZXIpO1xuXG4gICAgICAgIHRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGludm9rZUFzYXAgfHwgZm4uYXBwbHkoY3R4LCBhcmdzKTtcbiAgICAgICAgICAgIHRpbWVyID0gbnVsbDtcbiAgICAgICAgfSwgdGltZW91dCk7XG5cbiAgICB9O1xufTtcbiIsInZhciBkZWJvdW5jZSA9IHJlcXVpcmUoJy4vZGVib3VuY2UnKSxcbiAgICBzY3JvbGwgPSByZXF1aXJlKCcuL3Njcm9sbCcpO1xuXG4oZnVuY3Rpb24oZG9jLCB3aW4sICQsIHVuZGVmaW5lZCkge1xuICAgIHZhciAkd2luID0gJCh3aW4pO1xuXG4gICAgdmFyIFBhZ2VyID0gZnVuY3Rpb24oZWxlbSkge1xuICAgICAgICB2YXIgJGVsZW0gPSAkKGVsZW0pLFxuICAgICAgICAgICAgJG1vdmFibGUgPSAkZWxlbS5maW5kKCcucGFnZXJfX21vdmFibGUnKTtcblxuICAgICAgICBpZiAoJG1vdmFibGUubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAkbW92YWJsZSA9ICRlbGVtO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5fJGVsZW0gPSAkZWxlbTtcbiAgICAgICAgdGhpcy5faXRlbXMgPSBbXTtcbiAgICAgICAgdGhpcy5faXRlbXNDb3VudCA9IDA7XG4gICAgICAgIHRoaXMuX2N1cnJlbnRJdGVtID0gbnVsbDtcblxuICAgICAgICB0aGlzLmFkZEl0ZW1zKCRtb3ZhYmxlLmNoaWxkcmVuKCdhcnRpY2xlJykpO1xuXG4gICAgICAgIHRoaXMuX29uUmVzaXplID0gZGVib3VuY2UodGhpcy5fb25SZXNpemUsIDEwMCwgdGhpcyk7XG4gICAgICAgIHRoaXMuX29uU2Nyb2xsID0gZGVib3VuY2UodGhpcy5fb25TY3JvbGwsIDUwMCwgdGhpcyk7XG4gICAgICAgIHRoaXMuX29uVG91Y2hFbmQgPSB0aGlzLl9vblRvdWNoRW5kLmJpbmQodGhpcyk7XG4gICAgICAgIHRoaXMuX29uVG91Y2hTdGFydCA9IHRoaXMuX29uVG91Y2hTdGFydC5iaW5kKHRoaXMpO1xuICAgICAgICB0aGlzLl9vbldoZWVsU2Nyb2xsID0gdGhpcy5fb25XaGVlbFNjcm9sbC5iaW5kKHRoaXMpO1xuXG4gICAgICAgIHRoaXMuX2JpbmRFdmVudHModHJ1ZSk7XG4gICAgICAgIHRoaXMuX29uUmVzaXplKCk7XG5cbiAgICAgICAgJHdpbi5vbigncmVzaXplJywgdGhpcy5fb25SZXNpemUpO1xuXG4gICAgICAgICRlbGVtLmRhdGEoJ3BhZ2VyJywgdGhpcyk7XG4gICAgfTtcblxuICAgIHZhciBwYWdlciA9IFBhZ2VyLnByb3RvdHlwZTtcblxuICAgIHBhZ2VyLnN0ZXBNb3ZlID0gZnVuY3Rpb24oZGVsdGEsIG9wdGlvbnMpIHtcbiAgICAgICAgdmFyIG9wdHMgPSBvcHRpb25zIHx8IHt9LFxuICAgICAgICAgICAgY3VycmVudEl0ZW0sXG4gICAgICAgICAgICBzdGVwLFxuICAgICAgICAgICAgc3RlcHMsXG4gICAgICAgICAgICBuZXh0U3RlcDtcblxuICAgICAgICBjdXJyZW50SXRlbSA9IHRoaXMuX2N1cnJlbnRJdGVtO1xuXG4gICAgICAgIGlmICh0aGlzLl9jdXJyZW50UG9zaXRpb24gPT09IGN1cnJlbnRJdGVtLnN0YXJ0KSB7XG4gICAgICAgICAgICBzdGVwcyA9IGN1cnJlbnRJdGVtLnN0ZXBzO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHN0ZXBzKSB7XG4gICAgICAgICAgICBzdGVwID0gY3VycmVudEl0ZW0uc3RlcDtcbiAgICAgICAgICAgIG5leHRTdGVwID0gc3RlcCArIChkZWx0YSA+IDAgPyAxIDogLTEpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG5leHRTdGVwID49IDAgJiYgbmV4dFN0ZXAgPCBzdGVwcykge1xuICAgICAgICAgICAgaWYgKCAhIG9wdHMuY2hlY2tTY3JvbGwgfHwgdGhpcy5faXNSZWFsU2Nyb2xsKGRlbHRhKSkge1xuICAgICAgICAgICAgICAgIGN1cnJlbnRJdGVtLnN0ZXAgPSBuZXh0U3RlcDtcblxuICAgICAgICAgICAgICAgIHRoaXMuXyRlbGVtLnRyaWdnZXIoJ2NoYW5nZV9zdGVwJywge1xuICAgICAgICAgICAgICAgICAgICBpdGVtOiBjdXJyZW50SXRlbSxcbiAgICAgICAgICAgICAgICAgICAgcHJldjogc3RlcCxcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudDogbmV4dFN0ZXAsXG4gICAgICAgICAgICAgICAgICAgIGlzTGFzdDogbmV4dFN0ZXAgPT09IHN0ZXBzIC0gMSxcbiAgICAgICAgICAgICAgICAgICAgaXNGaXJzdDogbmV4dFN0ZXAgPT09IDBcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IGRlbHRhXG4gICAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXVxuICAgICAqIEByZXR1cm5zIHtQYWdlcn1cbiAgICAgKi9cbiAgICBwYWdlci5tb3ZlID0gZnVuY3Rpb24oZGVsdGEsIG9wdGlvbnMpIHtcbiAgICAgICAgdmFyIG9wdHMgPSBvcHRpb25zIHx8IHt9LFxuICAgICAgICAgICAgaXRlbSxcbiAgICAgICAgICAgIHN0ZXAsXG4gICAgICAgICAgICBzdGVwcyxcbiAgICAgICAgICAgIHBvc2l0aW9uLFxuICAgICAgICAgICAgbmV4dFN0ZXAsXG4gICAgICAgICAgICBjdXJyZW50SXRlbTtcblxuICAgICAgICBpZiAodGhpcy5pc0Rpc2FibGVkIHx8IHRoaXMuc2Nyb2xsaW5nKSB7XG4gICAgICAgICAgICB0aGlzLl9sYXN0U2Nyb2xsRGVsdGEgPSBkZWx0YTtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZGVsdGEgPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9XG5cbiAgICAgICAgY3VycmVudEl0ZW0gPSB0aGlzLl9jdXJyZW50SXRlbTtcblxuICAgICAgICBpZiAob3B0cy5jaGVja1N0ZXBzICYmIHRoaXMuX2N1cnJlbnRQb3NpdGlvbiA9PT0gY3VycmVudEl0ZW0uc3RhcnQpIHtcbiAgICAgICAgICAgIHN0ZXBzID0gY3VycmVudEl0ZW0uc3RlcHM7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoc3RlcHMpIHtcbiAgICAgICAgICAgIHN0ZXAgPSBjdXJyZW50SXRlbS5zdGVwO1xuICAgICAgICAgICAgbmV4dFN0ZXAgPSBzdGVwICsgKGRlbHRhID4gMCA/IDEgOiAtMSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobmV4dFN0ZXAgPj0gMCAmJiBuZXh0U3RlcCA8PSBzdGVwcyAtIDEpIHtcbiAgICAgICAgICAgIGlmICggISBvcHRzLmNoZWNrU2Nyb2xsIHx8IHRoaXMuX2lzUmVhbFNjcm9sbChkZWx0YSkpIHtcbiAgICAgICAgICAgICAgICBjdXJyZW50SXRlbS5zdGVwID0gbmV4dFN0ZXA7XG5cbiAgICAgICAgICAgICAgICB0aGlzLl8kZWxlbS50cmlnZ2VyKCdjaGFuZ2Vfc3RlcCcsIHtcbiAgICAgICAgICAgICAgICAgICAgaXRlbTogY3VycmVudEl0ZW0sXG4gICAgICAgICAgICAgICAgICAgIHByZXY6IHN0ZXAsXG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnQ6IG5leHRTdGVwLFxuICAgICAgICAgICAgICAgICAgICBpc0xhc3Q6IG5leHRTdGVwID09PSBzdGVwcyAtIDEsXG4gICAgICAgICAgICAgICAgICAgIGlzRmlyc3Q6IG5leHRTdGVwID09PSAwXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9XG5cbiAgICAgICAgcG9zaXRpb24gPSB0aGlzLl9jdXJyZW50UG9zaXRpb24gKyBkZWx0YTtcblxuICAgICAgICBpZiAoZGVsdGEgPiAwICYmIHRoaXMuX2N1cnJlbnRQb3NpdGlvbiA8IChjdXJyZW50SXRlbS5lbmQgLSB0aGlzLndpblNpemUuaGVpZ2h0KSkge1xuICAgICAgICAgICAgcG9zaXRpb24gPSBNYXRoLm1pbihwb3NpdGlvbiwgY3VycmVudEl0ZW0uZW5kIC0gdGhpcy53aW5TaXplLmhlaWdodCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRlbHRhIDwgMCAmJiB0aGlzLl9jdXJyZW50UG9zaXRpb24gPiBjdXJyZW50SXRlbS5zdGFydCkge1xuICAgICAgICAgICAgcG9zaXRpb24gPSBNYXRoLm1heChwb3NpdGlvbiwgY3VycmVudEl0ZW0uc3RhcnQpO1xuICAgICAgICB9XG5cbiAgICAgICAgaXRlbSA9IHRoaXMuX2dldEl0ZW1CeVBvc2l0aW9uKHBvc2l0aW9uLCBkZWx0YSA+IDAgPyAnZG93bicgOiAndXAnKTtcblxuICAgICAgICBpZiAoaXRlbSAhPT0gY3VycmVudEl0ZW0pIHtcbiAgICAgICAgICAgIGlmICggISBvcHRzLmNoZWNrU2Nyb2xsIHx8IHRoaXMuX2lzUmVhbFNjcm9sbChkZWx0YSkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50UG9zaXRpb24gPSBpdGVtLnN0YXJ0O1xuXG4gICAgICAgICAgICAgICAgdGhpcy5nb1RvKGl0ZW0uaW5kZXgsIHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5fbGFzdFNjcm9sbERlbHRhID0gZGVsdGE7XG4gICAgICAgICAgICB0aGlzLl9jdXJyZW50UG9zaXRpb24gPSBNYXRoLm1heChpdGVtLnN0YXJ0LCBNYXRoLm1pbihwb3NpdGlvbiwgaXRlbS5lbmQgLSB0aGlzLndpblNpemUuaGVpZ2h0KSk7XG4gICAgICAgICAgICB0aGlzLl9jdXJyZW50SXRlbSA9IGl0ZW07XG4gICAgICAgICAgICB0aGlzLm1vdmVUbyh7XG4gICAgICAgICAgICAgICAgdG86IHRoaXMuX2N1cnJlbnRQb3NpdGlvbixcbiAgICAgICAgICAgICAgICBkdXJhdGlvbjogMFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQHJldHVybnMge1BhZ2VyfVxuICAgICAqL1xuICAgIHBhZ2VyLnByZXYgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5nb1RvKHRoaXMuX2N1cnJlbnRJdGVtID8gdGhpcy5fY3VycmVudEl0ZW0uaW5kZXggLSAxIDogMCk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEByZXR1cm5zIHtQYWdlcn1cbiAgICAgKi9cbiAgICBwYWdlci5uZXh0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuZ29Ubyh0aGlzLl9jdXJyZW50SXRlbSA/IHRoaXMuX2N1cnJlbnRJdGVtLmluZGV4ICsgMSA6IDApO1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBAcmV0dXJucyB7UGFnZXJ9XG4gICAgICovXG4gICAgcGFnZXIuZ29UbyA9IGZ1bmN0aW9uKGl0ZW1JbmRleCwgaXNGb3JjZSkge1xuICAgICAgICB2YXIgY3VycmVudEl0ZW0gPSB0aGlzLmdldEl0ZW0oaXRlbUluZGV4KTtcblxuICAgICAgICBpZiAoY3VycmVudEl0ZW0pIHtcbiAgICAgICAgICAgIHRoaXMuc2V0Q3VycmVudEl0ZW0oY3VycmVudEl0ZW0sIGlzRm9yY2UpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7alF1ZXJ5fSAkaXRlbXNcbiAgICAgKiBAcmV0dXJucyB7UGFnZXJ9XG4gICAgICovXG4gICAgcGFnZXIuYWRkSXRlbXMgPSBmdW5jdGlvbigkaXRlbXMpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcyxcbiAgICAgICAgICAgIGlkID0gX3RoaXMuaWQsXG4gICAgICAgICAgICAkc2xpZGUsXG4gICAgICAgICAgICBzbGlkZUlkO1xuXG4gICAgICAgICQuZWFjaCgkaXRlbXMsIGZ1bmN0aW9uKGluZCwgc2xpZGUpIHtcbiAgICAgICAgICAgICRzbGlkZSA9ICQoc2xpZGUpO1xuICAgICAgICAgICAgc2xpZGVJZCA9ICRzbGlkZS5hdHRyKCdpZCcpIHx8ICgnc2xpZGUnICsgaW5kICsgMSk7XG4gICAgICAgICAgICAkc2xpZGUuYXR0cignaWQnLCBpZCArICdfJyArIHNsaWRlSWQpO1xuXG4gICAgICAgICAgICBfdGhpcy5faXRlbXNDb3VudCA9IF90aGlzLl9pdGVtcy5wdXNoKHtcbiAgICAgICAgICAgICAgICBpZDogc2xpZGVJZCxcbiAgICAgICAgICAgICAgICBpbmRleDogaW5kLFxuICAgICAgICAgICAgICAgIHN0ZXA6IHBhcnNlSW50KCRzbGlkZS5kYXRhKCdzdGVwJyksIDEwKSB8fCAwLFxuICAgICAgICAgICAgICAgIHN0ZXBzOiBwYXJzZUludCgkc2xpZGUuZGF0YSgnc3RlcHMnKSwgMTApIHx8IDAsXG4gICAgICAgICAgICAgICAgJGVsZW06ICRzbGlkZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtOdW1iZXJ8U3RyaW5nfSBbaXRlbUluZGV4XVxuICAgICAqIEByZXR1cm5zIHs/T2JqZWN0fVxuICAgICAqL1xuICAgIHBhZ2VyLmdldEl0ZW0gPSBmdW5jdGlvbihpdGVtSW5kZXgpIHtcbiAgICAgICAgdmFyIGluZGV4ID0gZmFsc2U7XG5cbiAgICAgICAgaWYgKHR5cGVvZiBpdGVtSW5kZXggPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICB0aGlzLl9pdGVtcy5zb21lKGZ1bmN0aW9uKHNsaWRlLCBpbmQpIHtcbiAgICAgICAgICAgICAgICBpZiAoc2xpZGUuaWQgPT09IGl0ZW1JbmRleCkge1xuICAgICAgICAgICAgICAgICAgICBpbmRleCA9IGluZDtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoJC5pc051bWVyaWMoaXRlbUluZGV4KSkge1xuICAgICAgICAgICAgaW5kZXggPSBpdGVtSW5kZXggPiAtMSAmJiBpdGVtSW5kZXggPCB0aGlzLl9pdGVtc0NvdW50ICYmIGl0ZW1JbmRleDtcbiAgICAgICAgfSBlbHNlIGlmICggISBpdGVtSW5kZXgpIHtcbiAgICAgICAgICAgIGluZGV4ID0gdGhpcy5fY3VycmVudEl0ZW0gJiYgdGhpcy5fY3VycmVudEl0ZW0uaW5kZXg7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gJC5pc051bWVyaWMoaW5kZXgpID9cbiAgICAgICAgICAgIHRoaXMuX2l0ZW1zW2luZGV4XSA6XG4gICAgICAgICAgICBudWxsO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW2RpcmVjdGlvbl1cbiAgICAgKiBAcmV0dXJucyB7UGFnZXJ9XG4gICAgICovXG4gICAgcGFnZXIudXBkYXRlUG9zaXRpb24gPSBmdW5jdGlvbihkaXJlY3Rpb24pIHtcbiAgICAgICAgdmFyIGl0ZW0gPSB0aGlzLl9nZXRJdGVtQnlQb3NpdGlvbih0aGlzLl9jdXJyZW50UG9zaXRpb24sIGRpcmVjdGlvbik7XG5cbiAgICAgICAgaWYgKGl0ZW0gIT09IHRoaXMuX2N1cnJlbnRJdGVtKSB7XG4gICAgICAgICAgICB0aGlzLmdvVG8oaXRlbS5pbmRleCwgdHJ1ZSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGN1cnJlbnRJdGVtXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBbaXNGb3JjZV1cbiAgICAgKiBAcmV0dXJucyB7UGFnZXJ9XG4gICAgICovXG4gICAgcGFnZXIuc2V0Q3VycmVudEl0ZW0gPSBmdW5jdGlvbihjdXJyZW50SXRlbSwgaXNGb3JjZSkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzLFxuICAgICAgICAgICAgcHJldkl0ZW0gPSBfdGhpcy5fY3VycmVudEl0ZW0sXG4gICAgICAgICAgICBpc0N1cnJlbnQgPSBjdXJyZW50SXRlbSA9PT0gcHJldkl0ZW07XG5cbiAgICAgICAgaWYgKCAhIGlzRm9yY2UgJiYgaXNDdXJyZW50KSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICggISBpc0N1cnJlbnQpIHtcbiAgICAgICAgICAgIHByZXZJdGVtICYmIHByZXZJdGVtLiRlbGVtLnJlbW92ZUNsYXNzKCdjdXJyZW50Jyk7XG5cbiAgICAgICAgICAgIF90aGlzLl8kZWxlbS50cmlnZ2VyKCdjaGFuZ2Vfc3RhcnQnLCB7XG4gICAgICAgICAgICAgICAgbmV4dDogY3VycmVudEl0ZW0sXG4gICAgICAgICAgICAgICAgY3VycmVudDogcHJldkl0ZW1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgX3RoaXNcbiAgICAgICAgICAgIC5tb3ZlVG8oeyB0bzogY3VycmVudEl0ZW0uc3RhcnQgfSlcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGlmICggISBpc0N1cnJlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudEl0ZW0uJGVsZW0uYWRkQ2xhc3MoJ2N1cnJlbnQnKTtcblxuICAgICAgICAgICAgICAgICAgICBfdGhpcy5fY3VycmVudEl0ZW0gPSBjdXJyZW50SXRlbTtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuXyRlbGVtXG4gICAgICAgICAgICAgICAgICAgICAgICAudHJpZ2dlcignY2hhbmdlX2RvbmUnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJldjogcHJldkl0ZW0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudDogY3VycmVudEl0ZW1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb3B0c1xuICAgICAqIEByZXR1cm4gez9qUXVlcnkuRGVmZXJyZWR9XG4gICAgICovXG4gICAgcGFnZXIubW92ZVRvID0gZnVuY3Rpb24ob3B0cykge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgICAgIGlmIChfdGhpcy5zY3JvbGxpbmcpIHtcbiAgICAgICAgICAgIF90aGlzLnNjcm9sbGluZy5yZWplY3QoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIF90aGlzLnNjcm9sbGluZyA9IHNjcm9sbChfdGhpcy5fJGVsZW0sIG9wdHMpO1xuXG4gICAgICAgIF90aGlzLnNjcm9sbGluZ1xuICAgICAgICAgICAgLmFsd2F5cyhmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5zY3JvbGxpbmcgPSBudWxsO1xuICAgICAgICAgICAgICAgIH0sIDApO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIF90aGlzLnNjcm9sbGluZztcbiAgICB9O1xuXG4gICAgcGFnZXIuZGlzYWJsZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmlzRGlzYWJsZWQgPSB0cnVlO1xuICAgIH07XG5cbiAgICBwYWdlci5lbmFibGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5pc0Rpc2FibGVkID0gZmFsc2U7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IFtwb3NpdGlvbl0g0J/QvtC30LjRhtC40Y9cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW2RpcmVjdGlvbl0g0J3QsNC/0YDQsNCy0LvQtdC90LjQtVxuICAgICAqIEByZXR1cm5zIHs/T2JqZWN0fSDQkNC50YLQtdC8LCDRgdC+0L7RgtCy0LXRgtGB0YLQstGD0Y7RidC40Lkg0L/QvtC30LjRhtC40LhcbiAgICAgKi9cbiAgICBwYWdlci5fZ2V0SXRlbUJ5UG9zaXRpb24gPSBmdW5jdGlvbihwb3NpdGlvbiwgZGlyZWN0aW9uKSB7XG4gICAgICAgIHZhciBzdGFydCA9IHBvc2l0aW9uIHx8IHRoaXMuX2N1cnJlbnRQb3NpdGlvbixcbiAgICAgICAgICAgIGVuZCA9IHN0YXJ0ICsgdGhpcy53aW5TaXplLmhlaWdodCxcbiAgICAgICAgICAgIGl0ZW1zID0gdGhpcy5faXRlbXMsXG4gICAgICAgICAgICBpdGVtc0xlbiA9IHRoaXMuX2l0ZW1zQ291bnQsXG4gICAgICAgICAgICBjaGVja2luZ0luZGV4ID0gMCxcbiAgICAgICAgICAgIG9mZnNldCxcbiAgICAgICAgICAgIGl0ZW07XG5cbiAgICAgICAgd2hpbGUgKChpdGVtID0gaXRlbXNbY2hlY2tpbmdJbmRleCsrXSkpIHtcbiAgICAgICAgICAgIG9mZnNldCA9IHN0YXJ0IC0gaXRlbS5zdGFydDtcblxuICAgICAgICAgICAgaWYgKCAhIGRpcmVjdGlvbikge1xuICAgICAgICAgICAgICAgIGlmIChpdGVtLmhlaWdodCAvIDIgPj0gb2Zmc2V0KSB7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKGRpcmVjdGlvbiA9PT0gJ2Rvd24nICYmIGl0ZW0uc3RhcnQgPD0gZW5kICYmIGl0ZW0uZW5kID49IGVuZCkge1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoZGlyZWN0aW9uID09PSAndXAnICYmIGl0ZW0uZW5kID4gc3RhcnQpIHtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCAhIGl0ZW0pIHtcbiAgICAgICAgICAgIGl0ZW0gPSBkaXJlY3Rpb24gPT09ICdkb3duJyA/IGl0ZW1zW2l0ZW1zTGVuIC0gMV0gOiBpdGVtc1swXTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBpdGVtO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gaXNPblxuICAgICAqL1xuICAgIHBhZ2VyLl9iaW5kRXZlbnRzID0gZnVuY3Rpb24oaXNPbikge1xuICAgICAgICB0aGlzLl8kZWxlbVtpc09uID8gJ29uJyA6ICdvZmYnXSgnb250b3VjaHN0YXJ0JyBpbiBkb2MuZG9jdW1lbnRFbGVtZW50ID9cbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB0b3VjaGVuZDogdGhpcy5fb25Ub3VjaEVuZCxcbiAgICAgICAgICAgICAgICB0b3VjaHN0YXJ0OiB0aGlzLl9vblRvdWNoU3RhcnRcbiAgICAgICAgICAgIH0gOlxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHdoZWVsOiB0aGlzLl9vbldoZWVsU2Nyb2xsLFxuICAgICAgICAgICAgICAgIHNjcm9sbDogdGhpcy5fb25TY3JvbGxcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICQoJy5wYWdlcl9fbmF2X2Rpcl9uZXh0JykuY2xpY2sodGhpcy5uZXh0LmJpbmQodGhpcykpO1xuICAgICAgICAkKCcucGFnZXJfX25hdl9kaXJfcHJldicpLmNsaWNrKHRoaXMucHJldi5iaW5kKHRoaXMpKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gbmV3RGVsdGFcbiAgICAgKiBAcmV0dXJucyB7QmJvb2xlYW59XG4gICAgICovXG4gICAgcGFnZXIuX2lzUmVhbFNjcm9sbCA9IGZ1bmN0aW9uKG5ld0RlbHRhKSB7XG4gICAgICAgIHZhciBvbGREZWx0YSA9IHRoaXMuX2xhc3RTY3JvbGxEZWx0YSxcbiAgICAgICAgICAgIGlzUmVhbFNjcm9sbCA9IGZhbHNlO1xuXG4gICAgICAgIGlmIChvbGREZWx0YSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgLy8gZGlmZmVyZW50IGRpcmVjdGlvblxuICAgICAgICAgICAgaWYgKG9sZERlbHRhIDwgMCAmJiBuZXdEZWx0YSA+IDApIHtcbiAgICAgICAgICAgICAgICBpc1JlYWxTY3JvbGwgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG9sZERlbHRhID4gMCAmJiBuZXdEZWx0YSA8IDApIHtcbiAgICAgICAgICAgICAgICBpc1JlYWxTY3JvbGwgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gc2FtZSBkaXJlY3Rpb25cbiAgICAgICAgICAgIGlmIChvbGREZWx0YSA+IDAgJiYgbmV3RGVsdGEgPiAwKSB7XG4gICAgICAgICAgICAgICAgaXNSZWFsU2Nyb2xsID0gb2xkRGVsdGEgPCBuZXdEZWx0YTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChvbGREZWx0YSA8IDAgJiYgbmV3RGVsdGEgPCAwKSB7XG4gICAgICAgICAgICAgICAgaXNSZWFsU2Nyb2xsID0gb2xkRGVsdGEgPiBuZXdEZWx0YTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlzUmVhbFNjcm9sbCA9IHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLl9sYXN0U2Nyb2xsRGVsdGEgPSBuZXdEZWx0YTtcblxuICAgICAgICByZXR1cm4gaXNSZWFsU2Nyb2xsO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7alF1ZXJ5LkV2ZW50fSBldmVudFxuICAgICAqL1xuICAgIHBhZ2VyLl9vbldoZWVsU2Nyb2xsID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgdmFyIGUgPSBldmVudC5vcmlnaW5hbEV2ZW50IHx8IHdpbmRvdy5ldmVudDtcblxuICAgICAgICBpZiAoTWF0aC5hYnMoZS5kZWx0YVkpIDwgTWF0aC5hYnMoZS5kZWx0YVgpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLm1vdmUoZS5kZWx0YVksIHtcbiAgICAgICAgICAgIGNoZWNrU2Nyb2xsOiB0cnVlLFxuICAgICAgICAgICAgY2hlY2tTdGVwczogdHJ1ZVxuICAgICAgICB9KTtcblxuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcblxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtqUXVlcnkuRXZlbnR9IGV2ZW50XG4gICAgICovXG4gICAgcGFnZXIuX29uVG91Y2hTdGFydCA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgIHRoaXMuX3RvdWNoU3RhcnRZID0gZXZlbnQub3JpZ2luYWxFdmVudC50b3VjaGVzWzBdLnBhZ2VZO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7alF1ZXJ5LkV2ZW50fSBldmVudFxuICAgICAqL1xuICAgIHBhZ2VyLl9vblRvdWNoRW5kID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgdGhpcy5tb3ZlKHRoaXMuX3RvdWNoU3RhcnRZIC0gZXZlbnQub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWSk7XG5cbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZmF0aW9uKCk7XG5cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIHBhZ2VyLl9vblNjcm9sbCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLm1vdmUodGhpcy5fJGVsZW0uc2Nyb2xsVG9wKCkgLSB0aGlzLl9jdXJyZW50UG9zaXRpb24pO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIHBhZ2VyLl9vblJlc2l6ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgd2luSGVpZ2h0ID0gJHdpbi5oZWlnaHQoKSxcbiAgICAgICAgICAgIGxhc3RFbmQgPSAwO1xuXG4gICAgICAgIHRoaXMuX2l0ZW1zLmZvckVhY2goZnVuY3Rpb24oc2xpZGUpIHtcbiAgICAgICAgICAgIHNsaWRlLmhlaWdodCA9IHNsaWRlLiRlbGVtLm91dGVySGVpZ2h0KCk7XG4gICAgICAgICAgICBzbGlkZS5zdGFydCA9IGxhc3RFbmQ7XG4gICAgICAgICAgICBzbGlkZS5lbmQgPSAobGFzdEVuZCArPSBzbGlkZS5oZWlnaHQpO1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLndpblNpemUgfHwgKHRoaXMud2luU2l6ZSA9IHt9KTtcbiAgICAgICAgdGhpcy53aW5TaXplLmhlaWdodCA9IHdpbkhlaWdodDtcblxuICAgICAgICB0aGlzLl9jdXJyZW50UG9zaXRpb24gPSB0aGlzLl8kZWxlbS5zY3JvbGxUb3AoKTtcblxuICAgICAgICB0aGlzLnVwZGF0ZVBvc2l0aW9uKCk7XG4gICAgfTtcblxuICAgICQuZm4ucGFnZXIgPSBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuZWFjaChmdW5jdGlvbihpbmQsIGVsZW0pIHtcbiAgICAgICAgICAgIC8qIGpzaGludCAtVzAzMSAqL1xuICAgICAgICAgICAgbmV3IFBhZ2VyKGVsZW0sIG9wdGlvbnMpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG59KShkb2N1bWVudCwgd2luZG93LCBqUXVlcnkpO1xuIiwibW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbigkZWxlbSwgb3B0aW9ucykge1xuICAgIHZhciBvcHRzID0gb3B0aW9ucyB8fCB7fSxcbiAgICAgICAgdG8gPSBwYXJzZUludChvcHRpb25zLnRvLCAxMCksXG4gICAgICAgIGR1cmF0aW9uID0gcGFyc2VJbnQob3B0cy5kdXJhdGlvbiwgMTApLFxuICAgICAgICBkZWZmID0gJC5EZWZlcnJlZCgpLFxuICAgICAgICBlYXNpbmc7XG5cbiAgICBpZiAoaXNOYU4oZHVyYXRpb24pKSB7XG4gICAgICAgIGR1cmF0aW9uID0gTWF0aC5zcXJ0KE1hdGguYWJzKCRlbGVtLnNjcm9sbFRvcCgpIC0gdG8pKSAqIDQwO1xuICAgIH1cblxuICAgIGlmIChkdXJhdGlvbiA+IDApIHtcbiAgICAgICAgZWFzaW5nID0gb3B0cy5lYXNpbmc7XG5cbiAgICAgICAgaWYgKHR5cGVvZiBlYXNpbmcgIT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICBlYXNpbmcgPSAnZWFzZU91dEN1YmljJztcbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZW9mICQuZWFzaW5nW2Vhc2luZ10gIT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIGVhc2luZyA9ICdsaW5lYXInO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgJGVsZW1cbiAgICAgICAgLnN0b3AoKVxuICAgICAgICAuYW5pbWF0ZShcbiAgICAgICAgICAgIHsgc2Nyb2xsVG9wOiB0byB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGR1cmF0aW9uOiBkdXJhdGlvbixcbiAgICAgICAgICAgICAgICBlYXNpbmc6IGVhc2luZyxcbiAgICAgICAgICAgICAgICBxdWV1ZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgZG9uZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIGRlZmYucmVzb2x2ZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgcmV0dXJuIGRlZmY7XG59O1xuIl19"}